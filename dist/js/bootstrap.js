/*!
 * PIQuest v0.0.40
 *  License
 */

// MIT license

define("config",[],function(){require.config({paths:{underscore:["//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min","../../bower_components/lodash-compat/lodash.min"],angular:["//ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min","../../bower_components/angular/angular.min"],animate:["//ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-animate.min","../../bower_components/angular-animate/angular-animate.min"],text:["//cdnjs.cloudflare.com/ajax/libs/require-text/2.0.10/text.min","../../bower_components/requirejs-text/text"],jquery:["//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min","../../bower_components/jquery/dist/jquery.min"]},packages:[{name:"pipScorer",location:"../../bower_components/PIPlayer/dist/js/extensions/dscore",main:"Scorer"}],shim:{angular:{exports:"angular"},animate:{deps:["angular"],exports:"angular"}},deps:["angular","animate","underscore","text"]}),window.name="NG_DEFER_BOOTSTRAP!"}),define("bootstrap",["./config"],function(){require.config({packages:[{name:"pipAPI",location:"APIs",main:"pipAPI"},{name:"questAPI",location:"APIs",main:"questAPI"},{name:"managerAPI",location:"APIs",main:"managerAPI"}]}),require(["angular","app"],function(e,t){e.element().ready(function(){e.resumeBootstrap([t.name])})})}),define("utils/timer/timerStopper",[],function(){function e(e){function t(){this.startTime=e()}return t.prototype.now=function(){return e()-this.startTime},t}return e.$inject=["timerNow"],e}),define("utils/timer/timerDirective",["require","underscore","angular"],function(e){function r(e,n){function s(e){if(!t.isPlainObject(e))throw new Error("Timer options must be an object");i=r.getScope(),i.options=t.defaults(e,{direction:"down",template:"normal",show:!0,removeOnEnd:!0,duration:0}),r.stopper=new n,r.targetTime=i.options.duration*1e3,i.options.show&&r.show(),u()}function o(){var t=i.options||{};i=r.getScope(),e.cancel(r.timeoutId),t.removeOnEnd&&r.remove()}function u(){var n=100,s=i.options,o=r.stopper.now(),f=r.targetTime-o;if(o>=r.targetTime){i.$emit("timer-end"),s.removeOnEnd&&r.remove();return}var l=s.direction==="up"?o:f;t.extend(i,a(l)),r.timeoutId=e(u,Math.min(n,f)),i.$emit("timer-tick")}function a(e){var t=Math.floor(e/1e3),n=Math.floor(t/3600),r=t%3600,i=Math.floor(r/60),s=r%60,o=Math.ceil(s),u={current:e,hours:n,minutes:i,seconds:o,milis:e%1e3};return u}var r=this,i={};r.start=s,r.stop=o}function i(e){return{controller:r,priority:400,link:function(t,r,i,s){function f(){u=n.element(o),r.prepend(u),e(u.contents())(a)}function l(){u&&u.remove(),u=null}var o='<div class="pi-timer well well-sm text-center" style="font-family: monospace;">{{minutes}}:{{zeroPad(seconds)}}</div>',u,a=t.$new();s.show=f,s.remove=l,s.getScope=function(){return a},a.zeroPad=function(t){return t<10?"0"+t:t},t.$on("$destroy",l)}}}var t=e("underscore"),n=e("angular");return r.$inject=["$timeout","timerStopper"],i.$inject=["$compile"],i}),define("utils/timer/timerNow",[],function(){var e;return!window.performance||(e=performance.now||performance.mozNow||performance.webkitNow||performance.msNow||performance.oNow),e?function(){return e.apply(performance)}:function(){return+(new Date)}}),define("utils/timer/timer-module",["require","angular","./timerStopper","./timerDirective","./timerNow"],function(e){var t=e("angular"),n=t.module("timer",[]);return n.service("timerStopper",e("./timerStopper")),n.directive("piTimer",e("./timerDirective")),n.value("timerNow",e("./timerNow")),n}),define("utils/utils/utilsModule",["require","angular","underscore"],function(e){var t=e("angular"),n=e("underscore"),r=t.module("pi.utils",[]);return r.service("piInvoke",["$injector",function(e){function r(r,i){var s=t.global||{};if(!r)return;e.invoke(r,null,n.extend(i,{global:s,current:s.current}))}var t=e.get("$rootScope");return r}]),r}),define("quest/directives/buttons/buttons",["require","angular"],function(e){var t=e("angular");return t.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(e){this.activeClass=e.activeClass||"active",this.toggleEvent=e.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(e,n,r,i){var s=i[0],o=i[1];o.$render=function(){n.toggleClass(s.activeClass,t.equals(o.$modelValue,e.$eval(r.btnRadio)))},n.bind(s.toggleEvent,function(){var i=n.hasClass(s.activeClass);(!i||t.isDefined(r.uncheckable))&&e.$apply(function(){o.$setViewValue(i?null:e.$eval(r.btnRadio)),o.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(e,n,r,i){function u(){return f(r.btnCheckboxTrue,!0)}function a(){return f(r.btnCheckboxFalse,!1)}function f(n,r){var i=e.$eval(n);return t.isDefined(i)?i:r}var s=i[0],o=i[1];o.$render=function(){n.toggleClass(s.activeClass,t.equals(o.$modelValue,u()))},n.bind(s.toggleEvent,function(){e.$apply(function(){o.$setViewValue(n.hasClass(s.activeClass)?a():u()),o.$render()})})}}})}),define("utils/database/template/templateFilter",["require","underscore"],function(e){function n(e,n){function r(r,i){if(!~r.indexOf("<%"))return r;i=t.extend(i||{},n);try{return t.template(r)(i)}catch(s){return e.error('ERROR: "'+s.message+'" in the following template: ',r),""}}return r}var t=e("underscore");return n.$inject=["$log","templateDefaultContext"],n}),define("utils/database/template/templateObjProvider",["require","underscore"],function(e){function n(e){function r(e,r){return t.forIn(e,function(e,i,s){t.isString(e)&&(s[i]=n(e,r))}),e}var n=e("template");return r}var t=e("underscore");return n.$inject=["$filter"],n}),define("utils/database/template/templateModule",["require","angular","./templateFilter","./templateObjProvider"],function(e){var t=e("angular"),n=t.module("template",[]);return n.filter("template",e("./templateFilter")),n.service("templateObj",e("./templateObjProvider")),n.constant("templateDefaultContext",{}),n}),define("utils/console/consoleProvider",["require","underscore"],function(e){function n(e){function n(n,r){var i=t.create(e);return t.extend(i,{tags:t.isArray(n)?n:[n],force:!!r}),i}function r(t){e.settings=t}return n.setSettings=r,n}var t=e("underscore");return n.$inject=["piConsolePrototype"],n}),define("utils/console/consolePrototypeProvider",["require","underscore"],function(e){function i(e,i){function o(e){var i=this.settings.level||"error",s=this.settings.tags||"all",o=this.tags,u=this.force;return u?!0:~t.indexOf(n,i)?r[e]>r[i]?!1:s!=="all"&&!t.intersection(o,t.isArray(s)?s:[s]).length?!1:!0:(this.settings.level="error",this.error('Unknow DEBUG level: "'+i+'". The valid levels are debug>info>warn>error>none'),!1)}function u(t){return function(){var n=this.settings,r,s=[];if(this.shouldLog(t)){for(r=0;r<arguments.length;r++)s[r]=arguments[r];e[t].apply(null,s);if(n.hideConsole)return;i.$emit("console:log",{time:new Date,type:t,args:s,tags:this.tags})}}}var s={};return t.each(n,function(e){s[e]=u(e)}),s.settings={},s.shouldLog=o,s}var t=e("underscore"),n=["log","info","warn","error","debug"],r={none:9,error:1,warn:2,info:3,log:4,debug:4};return i.$inject=["$log","$rootScope"],i}),define("text!utils/console/console.html",[],function(){return'<div>\n	<div\n		ng-repeat="log in logs | orderBy:\'time\':true"\n		class="alert"\n		ng-class="{\n			\'alert-warning\':log.type == \'warn\',\n			\'alert-danger\':log.type == \'error\',\n			\'alert-info\':log.type == \'info\',\n			\'alert-success\':log.type == \'log\',\n			\'alert-success\':log.type == \'debug\'\n\n		}"\n		role="alert"\n	>\n		<button ng-click="remove(log)" type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n		<strong>{{ log.type | uppercase}}:</strong> <i class="text-danger">{{log.time | date : \'HH:mm:ss:sss\'}}</i> - <strong>{{log.tags.join(\' \')}}</strong>:</br>\n		<span\n			ng-repeat="arg in log.args track by $index"\n			ng-click="pre = !pre"\n			ng-class="{pre:pre}"\n			ng-bind-html="arg | stringify:pre"\n		></span>\n\n	</div>\n</div>'}),define("utils/console/consoleDirective",["require","text!./console.html","underscore"],function(e){function r(e){return{replace:!0,template:t,link:function(t){function i(e){var t=n.indexOf(r,e);t>-1&&r.splice(t,1)}var r=t.logs=[];t.remove=i,t.reverse=!0,e.$on("console:log",function(e,t){r.push(t)})}}}var t=e("text!./console.html"),n=e("underscore");return r.$inject=["$rootScope"],r}),define("utils/console/consoleModule",["require","angular","./consoleProvider","./consolePrototypeProvider","./consoleDirective"],function(e){function r(e,n){if(e==null)return'<i class="text-muted">undefined</i>';if(e==="")return'<i class="text-muted">an empty string</i>';switch(typeof e){case"string":break;case"number":e=""+e;break;case"object":if(e instanceof Error){e=e.message;break};default:e='<a href="javascript:void(0)">'+t.toJson(e,!!n)+"</a>"}return e}var t=e("angular"),n=t.module("piConsole",[]);return n.service("piConsole",e("./consoleProvider")),n.service("piConsolePrototype",e("./consolePrototypeProvider")),n.directive("piConsole",e("./consoleDirective")),n.filter("stringify",function(){return r}),n}),define("text!utils/modal/modal.html",[],function(){return'<div class="modal in" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\n	<div class="modal-dialog">\n		<div class="modal-content">\n			<div class="modal-header" ng-ifs="header">\n				<button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close()"><span aria-hidden="true">&times;</span></button>\n				<h4 class="modal-title" id="myModalLabel">{{ header || "Heads Up!" }}</h4>\n			</div>\n			<div class="modal-body">{{body}}</div>\n			<div class="modal-footer">\n				<button type="button" class="btn btn-default" ng-click="close()">{{button || "Close"}}</button>\n			</div>\n		</div>\n	</div>\n</div>'}),define("utils/modal/modalService",["require","underscore","text!./modal.html","angular"],function(e){function i(e,i,s,o,u){function h(){a&&a.remove(),f&&f.$destroy(),l&&l.resolve(),c.remove(),u.off("keydown",h),i.removeClass("modal-open")}function p(p){var d=p.context||{};return h(),l=o.defer(),f=(p.$scope||e).$new(),f.close=h,u.on("keydown",h),f.header=t.template(p.header)(d),f.body=t.template(p.body)(d),f.button=t.template(p.button)(d),a=r.element(n),i.addClass("modal-open"),i.prepend(c),i.prepend(a),s(a.contents())(f),f.$digest(),l.promise}function d(e){var t=e.which||e.keyCode;t==27&&u.one("keydown",skipListener)}var a,f,l,c=r.element('<div class="modal-backdrop in"/>');this.open=p,this.close=h}var t=e("underscore"),n=e("text!./modal.html"),r=e("angular");return i.$inject=["$rootScope","$rootElement","$compile","$q","$document"],i}),define("utils/modal/modalModule",["require","angular","./modalService"],function(e){var t=e("angular"),n=t.module("pi.modal",[]);return n.service("piModal",e("./modalService")),n}),define("quest/directives/questController",["require","underscore"],function(e){function n(e,n,r,i,s,o){function c(n,c){function d(e){var r=e.response,i=f.correctValue;return t.isNumber(i)&&(i+=""),t.isNumber(r)&&(r+=""),t.isEqual(i,r)?n.$setValidity("correct",!0):n.$setValidity("correct",!1),e}c=t.defaults(c||{},l);var h=r(i.ngModel),p="dflt"in f?f.dflt:c.dflt;e.model=n,a=h(e.$parent),t.isUndefined(a)?(a={},h.assign(e.$parent,a)):s(["question"]).warn('This question has already been in use: "'+a.name+'"'),u.log=n.$modelValue=a,t.defaults(a,{name:f.name,response:p,serial:t.size(r("current.questions")(e.$parent))}),e.response=n.$viewValue=a.response,n.$formatters.push(function(e){return e.response}),n.$parsers.push(function(e){if(t.isUndefined(e))return a;var n=u.stopper.now();return a.response=e,a.latency=n,a.pristineLatency||(a.pristineLatency=n),a}),e.$watch("response",function(e,r){t.isEqual(e,r)||(n.$setViewValue(e),o(f.onChange,{log:a}))}),e.$on("$destroy",function(){o(f.onDestroy,{log:a})}),f.correct&&(n.$parsers.push(d),f.response=d(this.log)),o(f.onCreate,{log:a})}var u=this,a,f=e.data,l={dflt:NaN};this.scope=e,this.stopper=new n,this.registerModel=c,e.$on("quest:submit",function(e){e.preventDefault(),a.declined=undefined,a.submitLatency=u.stopper.now(),o(f.onSubmit,{log:a})}),e.$on("quest:decline",function(e){e.preventDefault(),a.declined=!0,a.submitLatency=u.stopper.now(),o(f.onDecline,{log:a})}),e.$on("quest:timeout",function(e){e.preventDefault(),a.timeout=!0,o(f.onTimeout,{log:a})})}var t=e("underscore");return n.$inject=["$scope","timerStopper","$parse","$attrs","piConsole","piInvoke"],n}),define("text!quest/directives/piQuest/piQuest.html",[],function(){return'<div piq-page ng-module="page"></div>'}),define("quest/directives/piQuest/piQuest-directive",["require","underscore","text!./piQuest.html","angular"],function(e){function i(e,n,r,i,s){function c(t,n){u.next(n),e.$emit("quest:newPage")}function h(t,n){u.prev(n),e.$emit("quest:newPage")}var o=this,u=o.task=new r(e.script),a,f=n.global,l=n.current||{};l.questions={},a={global:f,current:l,questions:l.questions},t.extend(i,a),t.extend(s,a),u.next(),e.$on("quest:next",c),e.$on("quest:prev",h),e.$on("quest:log",function(t,n,r){u.log(n,r,e.global)})}function s(e,s,o,u){return{controller:i,terminal:!0,priority:500,link:function(i,a,f,l){function v(){d&&(d.remove(),d=null),h&&(h.$destroy(),h=null),p&&(s.leave(p,function(){d=null}),d=p,p=null)}function m(){var t=c.current();if(t){var o=i.$new(),u=r(n);o.page=t,y(u,t.animate),v(),p=e(u)(o),s.enter(p,a),h=o,h.$emit("quest:updated")}else v()}function g(){h.page=c.current()}function y(e,n){if(!n)return;var r=n.split(" ");t.each(r,function(e){o.has("."+e+"-animation")||u(["page","animation"]).error('Unknown animation type: "'+e+'"')}),e.addClass(n)}var c=l.task,h,p,d;i.$on("quest:refresh",g),i.$on("quest:newPage",m),m()}}}var t=e("underscore"),n=e("text!./piQuest.html"),r=e("angular").element;return i.$inject=["$scope","$rootScope","Task","templateDefaultContext","mixerDefaultContext"],s.$inject=["$compile","$animate","$injector","piConsole"],s}),define("text!quest/directives/piQuest/piqPage.html",[],function(){return'<div ng-form name="pageForm" pi-timer>\n	<div pi-timer="page.timer"></div>\n	<div ng-if="page.progressBar" class="text-center" ng-bind-html="page.progressBar"></div>\n	<h3 ng-if="page.header" ng-bind-html="page.header" ng-style="page.headerStyle"></h3>\n	<div ng-bind-html="page.text"></div>\n	<ol ng-class="{\'list-unstyled\':!page.numbered}" start="{{page.numberStart}}">\n		<li ng-repeat="quest in page.questions">\n			<div quest-wrapper quest-data="quest" quest-current="current"></div>\n		</li>\n	</ol>\n\n	<div class="pull-right" ng-class="{\'btn-group\': !page.v1style, \'btn-toolbar\': page.v1style}">\n		<button\n			ng-click="prev()"\n			data-role="submit"\n			class="btn"\n			ng-if="page.prev && page.$meta.number > 1"\n		>{{page.prevText || "Go Back"}}</button>\n\n		<button\n			ng-click="submit()"\n			data-role="submit"\n			class="btn btn-primary"\n			ng-if="!page.noSubmit"\n		>{{page.submitText || "Submit"}}</button>\n\n		<button\n			ng-click="decline($event)"\n			data-role="submit"\n			class="btn btn-warning"\n			ng-class="{\'btn-active-accented\':page.v1style}"\n			ng-if="page.decline"\n		>{{page.declineText || "Decline to Answer"}}</button>\n	</div>\n</div>'}),define("quest/directives/piQuest/piqPage-directive",["require","text!./piqPage.html","underscore","angular"],function(e){function i(e,t,i,s){function u(){e.$emit("quest:refresh")}function a(t){function u(){var t=r.timer.message,u;o.log.timeout=!0,e.$broadcast("quest:timeout"),t?(u={pagesMeta:r.$meta,pagesData:r.data,global:i.global,current:i.current},n.isString(t)&&(t={body:t}),n.defaults(t,{header:"Timer Done",$context:u,$scope:e}),s.open(t).then(a)):a()}function a(){var t=r.timer.submitOnEnd||n.isUndefined(r.timer.submitOnEnd);t&&e.submit(!0)}var r=e.page;o.timer=t,o.log={name:r.name,startTime:+(new Date)},r.timer&&(t.start(r.timer),t.getScope().$on("timer-end",u))}var o=this;e.global=i.global,e.current=i.current,this.harvest=function(t){var r=e.current.questions;n.each(e.page.questions,function(n){if(!n.name||!t&&!n.lognow)return;var i=r[n.name];if(i.$logged)return;e.$emit("quest:log",i,o.log),i.$logged=!0})},e.submit=function(t){var n=e.pageForm.$valid;e.submitAttempt=!0;if(!n&&t!==!0)return!0;e.$broadcast("quest:submit"),o.proceed(),e.$emit("quest:next")},e.decline=function(t){var n=r.element(t.target),i=this.page.decline!=="double";i||n.hasClass("active")?(e.$broadcast("quest:decline"),o.proceed(),e.$emit("quest:next")):n.addClass("active")},e.prev=function(){o.proceed(),e.$broadcast("quest:prev")},this.proceed=function(){o.timer.stop(),o.harvest(e.page.lognow)},this.setup=a,e.$watch("current.questions",u,!0),e.$on("quest:submit:now",function(){e.submit()})}function s(){return{replace:!0,controller:i,template:t,require:["piqPage","piTimer"],link:function(e,t,n,r){r[0].setup(r[1])}}}var t=e("text!./piqPage.html"),n=e("underscore"),r=e("angular");return i.$inject=["$scope","$timeout","$rootScope","piModal"],s}),define("text!quest/directives/wrapper/wrapper.html",[],function(){return'<div class="form-group">\n	<label ng-hide="data.inline" for="{{data.name}}" ng-bind-html="data.stem"></label>\n	<div ng-bind-html="data.description"></div>\n	<div quest-data="data" ng-model="current.questions[data.name]"></div>\n	<p class="help-block" ng-if="data.help" ng-bind-html="data.helpText"></p>\n</div>'}),define("quest/directives/wrapper/wrapper-directive",["require","text!./wrapper.html"],function(e){function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e,i){return{replace:!0,template:n,priority:5,scope:{data:"=questData",current:"=questCurrent"},link:function(n,s){var o=n.data.type||"text",u=s.children().eq(2),a=/[A-Z]/g,f=t+r(o);if(!i.has(f+"Directive"))throw new Error('Unknown question type: "'+o+'"');f=f.replace(a,function(e,t){return(t?"-":"")+e.toLowerCase()}),u.attr(f,!0),e(u)(n)}}}var t="quest",n=e("text!./wrapper.html");return i.$inject=["$compile","$injector"],i}),define("text!quest/directives/text/text.html",[],function(){return'<div ng-form ng-class="{\'form-inline\':data.inline}">\n	<label ng-show="data.inline" for="{{data.name}}" ng-bind-html="data.stem"></label>\n	<input\n	 	type="text"\n		ng-model="response"\n		ng-minlength="{{data.minlength}}"\n		ng-maxlength="{{data.maxlength}}"\n		ng-pattern="data.pattern | toRegex"\n		ng-required="{{data.required}}"\n		class="form-control"\n		ng-attr-style="width:{{data.width | dfltUnits}}"\n\n		ng-keydown="data.maxlengthLimit && maxlengthLimit($event)"\n		ng-keyup="data.maxlengthLimit && maxlengthLimit($event)"\n	/>\n	<div pi-quest-validation="form.$error.minlength">{{data.errorMsg.minlength || "Too short!"}}</div>\n	<div pi-quest-validation="form.$error.maxlength">{{data.errorMsg.maxlength || "Too long!"}}</div>\n	<div pi-quest-validation="form.$error.pattern">{{data.errorMsg.pattern || "wrong pattern!"}}</div>\n	<div pi-quest-validation="form.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("text!quest/directives/text/textarea.html",[],function(){return'<div ng-form ng-class="{\'form-inline\':data.inline}">\n	<label ng-show="data.inline" for="{{data.name}}" ng-bind-html="data.stem"></label>\n	<textarea\n	 	type="text"\n		ng-model="response"\n		ng-minlength="{{data.minlength}}"\n		ng-maxlength="{{data.maxlength}}"\n		ng-pattern="data.pattern | toRegex"\n		ng-required="{{data.required}}"\n		class="form-control"\n\n		ng-attr-style="resize:none;width:{{data.columns? \'auto\' : data.width | dfltUnits}};"\n		cols="{{data.columns}}"\n		rows="{{data.rows}}"\n\n		ng-keydown="data.maxlengthLimit && maxlengthLimit($event)"\n		ng-keyup="data.maxlengthLimit && maxlengthLimit($event)"\n	/>\n	<div pi-quest-validation="form.$error.minlength">{{data.errorMsg.minlength || "Too short!"}}</div>\n	<div pi-quest-validation="form.$error.maxlength">{{data.errorMsg.maxlength || "Too long!"}}</div>\n	<div pi-quest-validation="form.$error.pattern">{{data.errorMsg.pattern || "wrong pattern!"}}</div>\n	<div pi-quest-validation="form.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("quest/directives/text/textDirective",["require","text!./text.html","text!./textarea.html","angular"],function(e){function i(){return{replace:!0,template:function(e,r){return"questText"in r?t:n},require:["form","ngModel"],controller:"questController",controllerAs:"ctrl",scope:{data:"=questData"},link:function(e,t,n,i){function f(t){var n=r.element(t.target),i=n.val(),s=a.maxlength||i.length;e.response=i.slice(0,s)}var s=i[0],o=i[1],u=e.ctrl,a=e.data;e.form=s,e.maxlengthLimit=f,u.registerModel(o,{dflt:""}),a.autoSubmit&&t.bind("keydown keypress",function(t){t.which===13&&(e.$apply(function(){e.$emit("quest:submit:now")}),t.preventDefault())})}}}var t=e("text!./text.html"),n=e("text!./textarea.html"),r=e("angular");return i}),define("text!quest/directives/text/text-number.html",[],function(){return'<div ng-form ng-class="{\'form-inline\':data.inline}">\n	<label ng-show="data.inline" for="{{data.name}}" ng-bind-html="data.stem"></label>\n	<input\n	 	type="number"\n		ng-model="response"\n		ng-required="{{data.required}}"\n		class="form-control"\n		ng-attr-style="width:{{data.width | dfltUnits}}"\n	>\n	<div pi-quest-validation="form.$error.number">{{data.errorMsg.number || "Must be a number!"}}</div>\n	<div pi-quest-validation="form.$error.qstMin">{{data.errorMsg.min || "Too small!"}}</div>\n	<div pi-quest-validation="form.$error.qstMax">{{data.errorMsg.max || "Too big!"}}</div>\n	<div pi-quest-validation="form.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("quest/directives/text/text-number-directive",["require","text!./text-number.html"],function(e){var t=e("text!./text-number.html"),n=function(){return{replace:!0,template:t,require:["form","ngModel","^?piqPage"],controller:"questController",controllerAs:"ctrl",scope:{data:"=questData"},link:function(e,t,n,r){var i=r[0],s=t.find("input"),o=s.eq(0).controller("ngModel");e.form=i,e.ctrl.registerModel(r[1],{dflt:""}),e.data.autoSubmit&&t.bind("keydown keypress",function(t){t.which===13&&(e.$apply(function(){e.$emit("quest:submit:now")}),t.preventDefault())});var u=function(t){var n=parseFloat(e.data.min);return!isNaN(n)&&t<n?(o.$setValidity("qstMin",!1),undefined):(o.$setValidity("qstMin",!0),t)};o.$parsers.push(u),o.$formatters.push(u);var a=function(t){var n=parseFloat(e.data.max);return!isNaN(n)&&t>n?(o.$setValidity("qstMax",!1),undefined):(o.$setValidity("qstMax",!0),t)};o.$parsers.push(a),o.$formatters.push(a)}}};return n}),define("quest/directives/select/selectMixerProvider",["require","underscore"],function(e){function n(e,n){function r(r,i){var s=n(r);return s=t.map(s,function(e,n){return t.isPlainObject(e)||(e={text:e}),t.isUndefined(e.value)&&(e.value=i.numericValues?n+1:e.text),e}),i.reverse&&(s=t(s).reverse().value()),i.randomize&&(s=e(s)),t.each(s,function(e,t){e.order=t}),s}return r}var t=e("underscore");return n.$inject=["randomizeShuffle","mixerRecursive"],n}),define("text!quest/directives/select/dropdown.html",[],function(){return'<div ng-form>\n	<select\n		ng-model="response"\n		ng-options="answer.value as answer.text group by answer.group for answer in quest.answers"\n		ng-required="data.required"\n		ng-change="data.autoSubmit && autoSubmit($event)"\n		class="form-control"\n		>\n		<option value="">{{chooseText || "-- Choose an option --"}}</option>\n	</select>\n	<div pi-quest-validation="model.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("quest/directives/select/dropdownDirective",["require","text!./dropdown.html"],function(e){function n(e,n){return{replace:!0,template:t,require:["ngModel"],controller:"questController",controllerAs:"ctrl",scope:{data:"=questData"},link:function(t,r,i,s){var o=s[0],u=t.ctrl;u.registerModel(o,{dflt:NaN}),t.quest={answers:e(t.data.answers||[],t.data)},t.chooseText="chooseText"in t.data&&t.data.chooseText,t.autoSubmit=function(){n(function(){t.$emit("quest:submit:now")})}}}}var t=e("text!./dropdown.html");return n.$inject=["questSelectMixer","$timeout"],n}),define("text!quest/directives/select/selectOne.html",[],function(){return'<div>\n	<div ng-class="listClass" ng-style="listCss">\n		<!-- track by in the ng-repeat allows us to keep the repeated object clean so that angular doesn\'t add a $$hashkey property -->\n		<!-- using interpolation within class, so that we can keep the style info separate within the directive -->\n		<a\n			tabindex="-1"\n			ng-repeat="answer in quest.answers track by answer.order"\n			ng-model="$parent.responseObj"\n			btn-radio="answer"\n			ng-class="$parent.listItemClass"\n			ng-style="listItemCss"\n			class="{{ $parent.response == answer.value ? \'active\' : \'\' }}"\n			uncheckable\n			ng-click="data.autoSubmit && autoSubmit($event)"\n			ng-bind-html="answer.text"\n			unselectable="on"\n		></a>\n	</div>\n	<div pi-quest-validation="model.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("quest/directives/select/selectOneDirective",["require","angular","underscore","text!./selectOne.html"],function(e){function i(e,n,i){return{replace:!0,require:["ngModel"],controller:"questController",controllerAs:"ctrl",scope:{data:"=questData"},link:function(s,o,u,a){function h(e){var t=f;if(t.$isEmpty(e)){t.$setValidity("required",!1);return}return t.$setValidity("required",!0),e}var f=a[0],l=s.ctrl,c=s.data;o.html(r),i(o.contents())(s),l.registerModel(f,{dflt:NaN}),s.quest={answers:e(s.data.answers||[],s.data)},s.$watch("responseObj",function(e,t){if(e===t)return;s.response=e&&e.value}),s.data.required&&(f.$formatters.push(h),f.$parsers.unshift(h),h(s.response)),s.data.buttons?s.data.style="horizontal":s.data.style=="horizontal"&&(s.data.buttons=!0),s.listCss={},s.listItemCss={};switch(c.style){case"horizontal":s.listClass="btn-group btn-group-justified btn-group-lg",s.listItemClass="btn btn-select";break;case"multiButtons":s.listClass="btn-toolbar",s.listItemClass="btn  btn-select",s.listCss.lineHeight=2.8;break;case"list":default:s.listClass="list-group",s.listItemClass="list-group-item"}c.minWidth&&(s.listItemCss.minWidth=c.minWidth),s.autoSubmit=function(e){if(!s.data.autoSubmit)return;var r=t.element(e.target).hasClass(n.activeClass);r&&s.$emit("quest:submit:now")}}}}var t=e("angular"),n=e("underscore"),r=e("text!./selectOne.html");return i.$inject=["questSelectMixer","buttonConfig","$compile"],i}),define("text!quest/directives/select/selectMulti.html",[],function(){return'<div required="{{data.required}}">\n	<div ng-class="listClass" ng-style="listCss">\n		<!-- track by in the ng-repeat allows us to keep the repeated object clean so that angular doesn\'t add a $$hashkey property -->\n		<a\n			href="javascript:void(0);"\n			ng-repeat="answer in quest.answers track by answer.order"\n			ng-model="answer.chosen"\n			btn-checkbox\n			ng-class="$parent.listItemClass"\n			ng-style="listItemCss"\n			class="{{ answer.chosen ? \'active\' : \'\' }}"\n			uncheckable\n			ng-bind-html="answer.text"\n			unselectable="on"\n		>\n		</a>\n	</div>\n	<div pi-quest-validation="model.$error.required && $parent.$parent.submitAttempt">{{data.errorMsg.required || "This field is required!"}}</div>\n	<div pi-quest-validation="model.$error.correct">{{data.errorMsg.correct || "You must answer the correct answer!"}}</div>\n</div>'}),define("quest/directives/select/selectMultiDirective",["require","underscore","text!./selectMulti.html"],function(e){function r(e){return{replace:!0,template:n,require:["^?piqPage","ngModel"],controller:"questController",controllerAs:"ctrl",scope:{data:"=questData"},link:function(n,r,i,s){var o=n.ctrl,u=s[1],a=n.data;o.registerModel(u,{dflt:[]}),u.$isEmpty=function(){return t.isEmpty(u.$viewValue)},n.quest={answers:e(n.data.answers||[],n.data)},t.each(n.quest.answers,function(e){~t.indexOf(n.response,e.value)&&(e.chosen=!0)}),n.data.buttons?n.data.style="horizontal":n.data.style=="horizontal"&&(n.data.buttons=!0),n.listCss={},n.listItemCss={};switch(a.style){case"horizontal":n.listClass="btn-group btn-group-justified btn-group-lg",n.listItemClass="btn btn-select";break;case"multiButtons":n.listClass="btn-toolbar",n.listItemClass="btn  btn-select",n.listCss.lineHeight=2.8;break;case"list":default:n.listClass="list-group",n.listItemClass="list-group-item"}a.minWidth&&(n.listItemCss.minWidth=a.minWidth),n.$watch("quest.answers",function(e,r){if(e===r)return;n.response=t(e).filter(function(e){return e.chosen}).pluck("value").value()},!0)}}}var t=e("underscore"),n=e("text!./selectMulti.html");return r.$inject=["questSelectMixer"],r}),define("quest/directives/toRegexFilter",["require","underscore"],function(e){function n(e){function n(n){var r;if(t.isUndefined(n))return/(?:)/;if(t.isRegExp(n)||t.isString(n))return new RegExp(n);throw r=new Error("Question pattern is not a valid regular expression"),e("text").error(r,n),r}return n}var t=e("underscore");return n.$inject=["piConsole"],n}),define("quest/directives/dfltUnitsFilter",["require","underscore"],function(e){function n(e,n){var i;return!e&&e!==0&&e!=="0"?"":r(e)?(i=t.isUndefined(n)?"px":String(n),e+i):e}function r(e){return!t.isArray(e)&&e-parseFloat(e)+1>=0}var t=e("underscore");return function(){return n}}),define("quest/directives/questDirectivesModule",["require","angular","utils/timer/timer-module","utils/utils/utilsModule","./buttons/buttons","utils/database/template/templateModule","utils/console/consoleModule","utils/modal/modalModule","./questController","./piQuest/piQuest-directive","./piQuest/piqPage-directive","./wrapper/wrapper-directive","./text/textDirective","./text/textDirective","./text/text-number-directive","./select/selectMixerProvider","./select/dropdownDirective","./select/selectOneDirective","./select/selectMultiDirective","./toRegexFilter","./dfltUnitsFilter"],function(e){var t=e("angular"),n=t.module("questDirectives",[e("utils/timer/timer-module").name,e("utils/utils/utilsModule").name,e("./buttons/buttons").name,e("utils/database/template/templateModule").name,e("utils/console/consoleModule").name,e("utils/modal/modalModule").name]);return n.controller("questController",e("./questController")),n.directive("piQuest",e("./piQuest/piQuest-directive")),n.directive("piqPage",e("./piQuest/piqPage-directive")),n.directive("questWrapper",e("./wrapper/wrapper-directive")),n.directive("questText",e("./text/textDirective")),n.directive("questTextarea",e("./text/textDirective")),n.directive("questTextNumber",e("./text/text-number-directive")),n.service("questSelectMixer",e("./select/selectMixerProvider")),n.directive("questDropdown",e("./select/dropdownDirective")),n.directive("questSelectOne",e("./select/selectOneDirective")),n.directive("questSelectMulti",e("./select/selectMultiDirective")),n.directive("piQuestValidation",function(){return{replace:!0,transclude:!0,scope:{unvalid:"=piQuestValidation"},template:['<div class="alert alert-danger" role="alert" ng-show="unvalid">','<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>',"<span ng-transclude></span>","</div>"].join("")}}),n.filter("toRegex",e("./toRegexFilter")),n.filter("dfltUnits",e("./dfltUnitsFilter")),n}),define("utils/logger/LoggerProvider",["require","underscore"],function(e){function n(e,n,r){function s(e){this.pending=[],this.sent=[],this.settings={},this.meta={},this.suppress=!1,this.dfltLogFn=e||function(e){return e}}var i=this;return t.extend(s.prototype,{log:function(){var e=this.settings,n=(e.logFn||this.dfltLogFn).apply(e,arguments);if(!t.isEmpty(this.meta)&&!t.isPlainObject(n))throw r(["logger"]).debug(n),new Error('Logger: in order to use "meta" the log must be an object.');t.extend(n,this.meta),r(["logger"]).debug("Logged: ",n),this.pending.push(n),i.logCounter++,e.pulse&&!this.suppress&&this.pending.length>=e.pulse&&this.send()},send:function(){function a(){u.resolve()}function f(){return e.post(s.url,o).then(a,function(){r(["logger"]).error('Failed to send data, it seems the backend is not responding. (sending to: "'+s.url+'")'),u.reject()})}var i,s=this.settings,o=this.pending,u=n.defer();if(o.length===0)return u.resolve(),u.promise;if(t.isUndefined(s.url))return r("logger").warn("The logger url is not set."),u.resolve(),u.promise;this.pending=[],e.post(s.url,o).then(a,f);for(i=0;i<o.length;i++)this.sent.push(o[i]);return u.promise},suppressPulse:function(e){this.suppress=t.isUndefined(e)?!0:e},getCount:function(){return i.logCounter},setSettings:function(e){if(arguments.length===0)return this.settings;this.settings=t.defaults({},e,i.settings);if(!t.isUndefined(e.meta)&&!t.isPlainObject(e.meta))throw new Error('Logger: "meta" must be an object.');this.meta=t.defaults({},e.meta,i.meta)}}),s}var t=e("underscore");return n.$inject=["$http","$q","piConsole"],function(){this.$get=n,this.settings={},this.meta={},this.logCounter=0}}),define("utils/logger/logger-module",["require","angular","./LoggerProvider","utils/console/consoleModule"],function(e){var t=e("angular"),n=e("./LoggerProvider"),r=t.module("logger",[e("utils/console/consoleModule").name]);return r.provider("Logger",n),r}),define("utils/database/randomize/randomizeModule",["require","angular","underscore"],function(e){var t=e("angular"),n=e("underscore"),r=t.module("randomize",[]);return r.value("randomizeRandom",Math.random),r.value("randomizeShuffle",n.shuffle),r.value("randomizeInt",function(t){return Math.floor(Math.random()*t)}),r.value("randomizeRange",function(t){return n.shuffle(n.range(t))}),r}),define("utils/database/mixer/mixer",["underscore"],function(e){function t(t,n){function r(t){var n=t.mixer;if(!(e.isPlainObject(t)&&"mixer"in t))return[t];if(e.isUndefined(r.mixers[n]))throw new Error("Mixer: unknow mixer type = "+n);return!t.remix&&t.$parsed?t.$parsed:(t.$parsed=r.mixers[n].apply(null,arguments),t.$parsed)}return r.mixers={wrapper:function(e){return e.data},repeat:function(t){var n=t.data||[],r=[],i;for(i=0;i<t.times;i++)r=r.concat(e.clone(n,!0));return r},random:function(n,i){function s(t){return e.reduce(t,function(t,n){if(e.isPlainObject(n)&&"mixer"in n&&n.mixer!="wrapper"){var s=r(n,i);return t.concat(s)}return t.concat([n])},[])}var o=n.data||[];return t(s(o))},choose:function(n){var r=n.data||[];return e.take(t(r),n.n?n.n:1)},weightedRandom:function(t){var r=t.data||[],i,s=e.reduce(t.weights,function(e,t){return e+t}),o=n()*s,u=0;for(i=0;i<r.length;i++){u+=t.weights[i],u=+u.toFixed(3);if(o<=u)return[t.data[i]]}throw new Error("Mixer: something went wrong with weightedRandom")}},r}return t.$inject=["randomizeShuffle","randomizeRandom"],t}),define("utils/database/mixer/mixerSequential",["require","underscore"],function(e){function n(e){function n(r,i,s){var o,u=r[0];s=s||0;if(s++>=10)throw new Error("Mixer: the mixer allows a maximum depth of 10");return t.isUndefined(u.mixer)?r:(o=e(u,i),r.shift(),o=o.concat(r),t.isUndefined(o[0])||t.isUndefined(o[0].mixer)?o:n(o,i,s))}return n}var t=e("underscore");return n.$inject=["mixer"],n}),define("utils/database/mixer/mixerRecursive",["require","underscore"],function(e){function n(e){function n(r,i,s){var o=[];s=s||0;if(s++>=10)throw new Error("Mixer: the mixer allows a maximum depth of 10");return o=t(r).map(function(r){return t.isUndefined(r.mixer)?r:n(e(r,i),i,s)}).flatten().value(),o}return n}var t=e("underscore");return n.$inject=["mixer"],n}),define("utils/database/mixer/mixerSequenceProvider",["require","underscore"],function(e){function n(e){function n(e){this.sequence=e,this.stack=[],this.add(e),this.pointer=0}return t.extend(n.prototype,{add:function(e,t){this.stack.push({pointer:t?e.length:-1,sequence:e})},proceed:function(n,r){var i=this.stack[this.stack.length-1],s=n==="next";if(!i)throw new Error("mixerSequence: subSequence not found");i.pointer+=s?1:-1;var o=i.sequence[i.pointer];return t.isUndefined(o)&&this.stack.length>1?(this.stack.pop(),this.proceed.call(this,n,r)):o&&o.mixer?(this.add(e(o,r),!s),this.proceed.call(this,n,r)):this},next:function(e){return this.pointer++,this.proceed.call(this,"next",e)},prev:function(e){return this.pointer--,this.proceed.call(this,"prev",e)},current:function(){var e=this.stack[this.stack.length-1];if(!e)throw new Error("mixerSequence: subSequence not found");var t=e.sequence[e.pointer];return t?(t.$meta=this.meta(),t):undefined},meta:function(){return{number:this.pointer,outOf:t.reduce(this.stack,function(e,t){return e+t.sequence.length-1},0)+1}}}),n}var t=e("underscore");return n.$inject=["mixer"],n}),define("utils/database/mixer/branching/dotNotation",["require","underscore"],function(e){function n(e,n){return t.isString(e)&&(e=e.split(".")),t.reduce(e,function(e,n){return t.isPlainObject(e)||t.isArray(e)?e[n]:undefined},n)}var t=e("underscore");return n}),define("utils/database/mixer/branching/mixerDotNotationProvider",["require","underscore"],function(e){function n(e){function n(n,r){var i=/[^\/]\./;return t.isString(n)?i.test(n)?e(n,r):n.replace("/.","."):n}return n}var t=e("underscore");return n.$inject=["dotNotation"],n}),define("utils/database/mixer/branching/mixerConditionProvider",["require","underscore"],function(e){function n(e,n){function r(r,i){var s,o,u;t.isFunction(r)?u=r:(s=e(r.compare,i),o=e(r.to,i),u=r.operator),n(["conditions"]).info("Condition: ",s,u||"equals",o,r);if(t.isFunction(u))return!!u.apply(i,[s,o,i]);switch(u){case"greaterThan":if(t.isNumber(s)&&t.isNumber(o))return+s>+o;return!1;case"greaterThanOrEqual":if(t.isNumber(s)&&t.isNumber(o))return+s>=+o;return!1;case"in":if(t.isArray(o))return~t.indexOf(o,s);return!1;case"exactly":return s===o;case"equals":default:if(t.isUndefined(o))return!!s;return t.isEqual(s,o)}return u}return r}var t=e("underscore");return n.$inject=["mixerDotNotation","piConsole"],n}),define("utils/database/mixer/branching/mixerEvaluateProvider",["require","underscore"],function(e){function n(e){function n(r,i){function s(e){return n(e,i)}return t.isArray(r)&&(r={and:r}),r.and?t.every(r.and,s):r.nand?!t.every(r.nand,s):r.or?t.some(r.or,s):r.nor?!t.some(r.nor,s):e(r,i)}return n}var t=e("underscore");return n.$inject=["mixerCondition"],n}),define("utils/database/mixer/branching/mixerBranchingDecorator",["require","underscore"],function(e){function n(e,n,r){function i(e,i){return i=t.extend(i||{},r),n(e.conditions,i)?e.data||[]:e.elseData||[]}function s(e,i){i=t.extend(i||{},r);var s;return s=t.find(e.branches,function(e){return n(e.conditions,i)}),s?s.data||[]:e.elseData||[]}return e.mixers.branch=i,e.mixers.multiBranch=s,e}var t=e("underscore");return n.$inject=["$delegate","mixerEvaluate","mixerDefaultContext"],n}),define("utils/database/mixer/mixerModule",["require","angular","../randomize/randomizeModule","utils/console/consoleModule","./mixer","./mixerSequential","./mixerRecursive","./mixerSequenceProvider","./branching/dotNotation","./branching/mixerDotNotationProvider","./branching/mixerConditionProvider","./branching/mixerEvaluateProvider","./branching/mixerBranchingDecorator"],function(e){var t=e("angular"),n=t.module("mixer",[e("../randomize/randomizeModule").name,e("utils/console/consoleModule").name]);return n.service("mixer",e("./mixer")),n.service("mixerSequential",e("./mixerSequential")),n.service("mixerRecursive",e("./mixerRecursive")),n.service("MixerSequence",e("./mixerSequenceProvider")),n.value("dotNotation",e("./branching/dotNotation")),n.service("mixerDotNotation",e("./branching/mixerDotNotationProvider")),n.service("mixerCondition",e("./branching/mixerConditionProvider")),n.service("mixerEvaluate",e("./branching/mixerEvaluateProvider")),n.config(["$provide",function(t){t.decorator("mixer",e("./branching/mixerBranchingDecorator"))}]),n.constant("mixerDefaultContext",{}),n}),define("utils/database/collection/collectionProvider",["underscore"],function(e){function t(){function t(n){if(n instanceof t)return n;if(!e.isUndefined(n)&&!e.isArray(n)&&!(n instanceof t))throw new Error("Collections can only be constructed from arrays");this.collection=n||[],this.length=this.collection.length,this.pointer=-1}e.extend(t.prototype,{first:function(){return this.pointer=0,this.collection[this.pointer]},last:function(){return this.pointer=this.collection.length-1,this.collection[this.pointer]},end:function(){return this.pointer=this.collection.length,undefined},current:function(){return this.collection[this.pointer]},next:function(){return this.collection[++this.pointer]},previous:function(){return this.collection[--this.pointer]},add:function(t){return arguments.length?(t=e.isArray(t)?t:[t],this.collection=this.collection.concat(t),this.length=this.collection.length,this):this},at:function(e){return this.collection[e]}});var n=["where","filter"],r=Array.prototype.slice;return e.each(n,function(n){t.prototype[n]=function(){var i=r.call(arguments);i.unshift(this.collection);var s=e[n].apply(e,i);return new t(s)}}),t}return t}),define("utils/database/randomizer/randomizerProvider",["underscore"],function(e){function t(t,n,r){function i(){this._cache={random:{},exRandom:{},sequential:{}}}function s(n,r,i){var s=this._cache.random;return i&&!e.isUndefined(s[r])?s[r]:(s[r]=t(n),s[r])}function o(t,n,i){var s=this._cache.sequential,o=s[n],u;if(e.isUndefined(o))return o=s[n]=new r(e.range(t)),o.first();if(o.length!==t)throw new Error("This seed  ("+n+") points to a collection with the wrong length, you can only use a seed for sets of the same length");return i?o.current():(u=o.next(),e.isUndefined(u)?o.first():u)}function u(t,i,s){var o=this._cache.exRandom,u=o[i],a;if(e.isUndefined(u))return u=o[i]=new r(n(t)),u.first();if(u.length!==t)throw new Error("This seed  ("+i+") points to a collection with the wrong length, you can only use a seed for sets of the same length");return s?u.current():(a=u.next(),e.isUndefined(a)?(u=o[i]=new r(n(t)),u.first()):a)}return e.extend(i.prototype,{random:s,exRandom:u,sequential:o}),i}return t.$inject=["randomizeInt","randomizeRange","Collection"],t}),define("utils/database/queryProvider",["underscore"],function(e){function t(t,n){function r(r,i,s){var o=new t(i);if(e.isFunction(r))return r(i);if(e.isString(r)||e.isNumber(r))r={set:r,type:"random"};r.set&&(o=o.where({set:r.set})),e.isString(r.data)&&(o=o.filter(function(e){return e.handle===r.data||e.data&&e.data.handle===r.data})),e.isPlainObject(r.data)&&(o=o.where({data:r.data})),e.isFunction(r.data)&&(o=o.filter(r.data));var u=r.seed||"$"+i.namespace+r.set,a=o.length,f=r.repeat,l,c;switch(r.type){case undefined:case"byData":case"random":l=s.random(a,u,f);break;case"exRandom":l=s.exRandom(a,u,f);break;case"sequential":l=s.sequential(a,u,f);break;case"first":l=0;break;case"last":l=a-1;break;default:throw new Error("Unknow query type: "+r.type)}if(e.isUndefined(o.at(l)))throw c=new Error("Query failed, object ("+JSON.stringify(r)+") not found. If you are trying to apply a template, you should know that they are not supported for inheritance."),n("query").error(c),c;return o.at(l)}return r}return t.$inject=["Collection","piConsole"],t}),define("utils/database/inflateProvider",["require","underscore"],function(e){function n(e,n,r){function i(e){return t.isFunction(e.customize)&&e.customize.apply(e,[e,n.global]),e}function s(n,o,u,a,f){f=a?--f:10;if(!f)throw new Error("Inheritance loop too deep, you can only inherit up to 10 levels down");if(!t.isPlainObject(n))throw new Error("You are trying to inflate a non object");var l,c=t.cloneDeep(n),h,p=c.inherit;if(!c.inherit)return!a&&i(c),c;l=e(p,o,u);if(!l)throw h=new Error("Query failed, object ("+JSON.stringify(p)+") not found."),r("query").error(h),h;l=s(l,o,u,!0,f);if(p.merge&&!t.isArray(p.merge))throw new Error("Inheritance error: inherit.merge must be an array.");return t.each(l,function(e,n){var r,i;if(!(n in c)){c[n]=t.isFunction(e)?e:t.cloneDeep(e);return}if(t.indexOf(p.merge,n)!=-1){r=c[n],i=e;if(t.isArray(r)){if(!t.isArray(i))throw new Error('Inheritance error: You tried merging an array with an non array (for "'+n+'")');c[n]=r.concat(i)}if(t.isPlainObject(r)){if(!t.isPlainObject(i))throw new Error('Inheritance error: You tried merging an object with an non object (for "'+n+'")');t.extend(r,i)}}}),l.data&&(c.data=t.extend(l.data,c.data||{})),!a&&i(c),c}return s}var t=e("underscore");return n.$inject=["databaseQuery","$rootScope","piConsole"],n}),define("utils/database/store/storeProvider",["underscore"],function(e){function t(t){function n(){this.store={}}return e.extend(n.prototype,{create:function(n){if(this.store[n])throw new Error("The name space "+n+" already exists");this.store[n]=new t,this.store[n].namespace=n},read:function(t){if(!this.store[t])throw new Error("The name space "+t+" does not exist");return this.store[t]},update:function(t,n){var r=this.read(t);r.add(n)},del:function(t){this.store[t]=undefined}}),n}return t.$inject=["Collection"],t}),define("utils/database/databaseProvider",["require","underscore"],function(e){function n(e,n,r,i,s){function o(){this.store=new e,this.randomizer=new n}return t.extend(o.prototype,{createColl:function(e){this.store.create(e)},getColl:function(e){return this.store.read(e)},add:function(e,t){var n=this.store.read(e);n.add(t)},inflate:function(e,t,n){var s=this.getColl(e);if(!t.$inflated||t.reinflate)t.$inflated=r(t,s,this.randomizer);if(!t.$templated||t.regenerateTemplate)n[e+"Data"]=t.$inflated.data||{},n[e+"Meta"]=t.$meta,t.$templated=i(t.$inflated,n);return t.$templated},sequence:function(e,n){if(!t.isArray(n))throw new Error("Sequence must be an array.");return new s(e,n,this)}}),o}var t=e("underscore");return n.$inject=["DatabaseStore","DatabaseRandomizer","databaseInflate","templateObj","databaseSequence"],n}),define("utils/database/databaseSequenceProvider",["require","underscore"],function(e){function n(e){function n(t,n,r){this.namespace=t,this.mixerSequence=new e(n),this.db=r}return t.extend(n.prototype,{next:function(e){return this.mixerSequence.next(e),this},prev:function(e){return this.mixerSequence.prev(e),this},current:function(e){e||(e={});var t=this.mixerSequence.current(e);return t?this.db.inflate(this.namespace,t,e):t},all:function(e){var t=[],n=this.next().current(e);while(n)t.push(n),n=this.next().current(e);return t}}),n}var t=e("underscore");return n.$inject=["MixerSequence"],n}),define("utils/database/databaseModule",["require","angular","./mixer/mixerModule","./template/templateModule","utils/console/consoleModule","./collection/collectionProvider","./randomizer/randomizerProvider","./queryProvider","./inflateProvider","./store/storeProvider","./databaseProvider","./databaseSequenceProvider"],function(e){var t=e("angular"),n=t.module("database",[e("./mixer/mixerModule").name,e("./template/templateModule").name,e("utils/console/consoleModule").name]).service("Collection",e("./collection/collectionProvider")).service("DatabaseRandomizer",e("./randomizer/randomizerProvider")).service("databaseQuery",e("./queryProvider")).service("databaseInflate",e("./inflateProvider")).service("DatabaseStore",e("./store/storeProvider")).service("Database",e("./databaseProvider")).service("databaseSequence",e("./databaseSequenceProvider"));return n}),define("quest/task/questSequenceProvider",["require","underscore"],function(e){function n(){function e(e,t){if(!t)throw new Error("Sequences need to take a db as the second argument");this.sequence=t.sequence("pages",e),this.db=t}return t.extend(e.prototype,{next:function(e){return this.sequence.next(e),this},prev:function(e){return this.sequence.prev(e),this},current:function(e){var n,r=this.sequence.current(e);if(!r)return r;r.questions?n=t.isArray(r.questions)?r.questions:[r.questions]:n=[];var i=this.db.sequence("questions",n).all({pagesData:r.data,pagesMeta:r.$meta});return r=t.clone(r,!0),r.questions=i,r}}),e}var t=e("underscore");return n}),define("quest/task/taskProvider",["underscore","angular"],function(e,t){function n(n,r,i,s,o,u,a){function f(f){var l=this,c=f.settings||{};this.script=f,this.db=new r,this.logger=new i(u),this.logger.setSettings(c.logger||{}),this.q=n.defer();if(!e.isArray(f.sequence))throw new Error("Task: no sequence was defined");this.sequence=new s(f.sequence,this.db),this.promise=this.q.promise.then(function(){return l.logger.suppressPulse(),e.each(a.current.questions,function(e){if(e.$logged)return!0;l.log(e,{},a.global),e.$logged=!0}),l.logger.suppressPulse(!1),l.logger.send()})["finally"](c.onEnd||t.noop),o(f,this.db)}return e.extend(f.prototype,{log:function(){this.logger.log.apply(this.logger,arguments)},current:function(){var e=this.sequence.current();return e||this.q.resolve(),e},next:function(){return this.sequence.next()},prev:function(){return this.sequence.prev()}}),f}return n.$inject=["$q","Database","Logger","QuestSequence","taskParse","dfltQuestLogger","$rootScope"],n}),define("quest/task/parseProvider",[],function(){function e(e){function t(t,n){n.createColl("pages"),n.createColl("questions"),n.add("pages",t.pagesSets||[]),n.add("questions",t.questionsSets||[]),t.settings||(t.settings={}),e.setSettings(t.settings.DEBUG||{})}return t}return e.$inject=["piConsole"],e}),define("quest/task/dfltQuestLogger",["require","underscore"],function(e){function n(e,n,r){r;var i=t.extend({},n,e);return i.declined&&(i.response=e.responseObj=undefined),i}var t=e("underscore");return n}),define("quest/task/task-module",["require","angular","utils/logger/logger-module","utils/database/databaseModule","utils/console/consoleModule","./questSequenceProvider","./taskProvider","./parseProvider","./dfltQuestLogger"],function(e){var t=e("angular"),n=t.module("task",[e("utils/logger/logger-module").name,e("utils/database/databaseModule").name,e("utils/console/consoleModule").name]);return n.service("QuestSequence",e("./questSequenceProvider")),n.service("Task",e("./taskProvider")),n.service("taskParse",e("./parseProvider")),n.value("dfltQuestLogger",e("./dfltQuestLogger")),n}),define("quest/questModule",["require","quest/directives/questDirectivesModule","quest/task/task-module"],function(e){e("quest/directives/questDirectivesModule"),e("quest/task/task-module");var t=angular.module("piQuest",["questDirectives","task"]);return t.config(["$sceProvider",function(e){e.enabled(!1)}]),t}),define("message/messageDirective",["require","underscore"],function(e){function n(e,n,r,i){return{link:function(s,o){function p(e){var n=t.isArray(a.keys)?a.keys:[a.keys],r=t.map(n,function(e){return t.isString(e)?e.toUpperCase().charCodeAt(0):e});~t.indexOf(r,e.which)&&s.done()}function d(){f.$destroy(),o.empty(),s.$emit("message:done")}var u="keydown",a=s.script,f=s.newScope=s.$new(),l,c={global:n.global,current:n.current,task:a};try{l=t.template(a.$template)(c)}catch(h){l=a.$template,i("message").error("failed to render template",h)}t.extend(s,c),s.done=d,r.on(u,p),s.$on("$destroy",function(){r.off(u,p)}),o.html(l),e(o.contents())(f)}}}var t=e("underscore");return n.$inject=["$compile","$rootScope","$document","piConsole"],n}),define("message/messageDoneDirective",[],function(){function e(){return{link:function(e,t){t.on("click",function(){e.done()})}}}return e.$inject=[],e}),define("message/messageModule",["require","angular","utils/console/consoleModule","./messageDirective","./messageDoneDirective"],function(e){var t=e("angular"),n=t.module("pi.message",[e("utils/console/consoleModule").name]);return n.directive("piMessage",e("./messageDirective")),n.directive("piMessageDone",e("./messageDoneDirective")),n}),define("taskManager/task/taskActivateProvider",["require","underscore"],function(e){function n(){var e={};this.$get=r,this.set=function(n,r){e[n]=r},this.get=function(t){return e[t]}}function r(e,n,r){function s(s,o,u){var a,f=e.defer(),l=n.global,c=s.$script,h;t.isFunction(c)&&(a=c),!a&&c&&t.isFunction(c.play)&&(a=t.bind(c.play,c),a.$inject=r.annotate(c.play)),!a&&c&&t.isArray(c.play)&&(a=t.bind(c.play[c.play.length-1],c),a.$inject=r.annotate(c.play)),!a&&s.type&&(a=i.get(s.type));if(!t.isFunction(a))throw new Error('Activator function not found for the "'+s.type+'" task');return h=r.invoke(a,null,{done:t.bind(f.resolve,f),task:s,script:c,$element:o,$scope:u,global:l}),t.isFunction(h)&&f.promise["finally"](h),f}var i=this;return s}var t=e("underscore");return r.$inject=["$q","$rootScope","$injector"],n}),define("taskManager/task/taskDirective",["require","underscore"],function(e){function n(e,n,r,i,s){return{scope:{task:"=piTask"},link:function(o,u){function m(e){var t=e.key||e.which||e.keyCode;t==82&&e.ctrlKey&&y(e,"current"),t==27&&r.one("keydown",g)}function g(e){var t=e.which||e.keyCode;t==37&&y(e,"prev"),t==39&&y(e,"next")}function y(e,t){e.preventDefault(),p={type:t,bustCache:!0},c.resolve()}var a=o.task,f,l,c,h,p,d=o.$parent.settings||{},v=a.$script||{};if(!a)return;d.skip&&(r.on("keydown",m),o.$on("$destroy",function(){r.off("keydown",m),r.off("keydown",g)})),s.current=i.piGlobal.current=v.current||{},v.name&&(t.extend(s.current,i.piGlobal[v.name]||{}),i.piGlobal[v.name]=v.current),c=e(a,u,o.$new()),h=c.promise,f=n(a.canvas),h["finally"](f),a.title&&(l=r[0].title,r[0].title=a.title,h["finally"](function(){r[0].title=l})),h["finally"](function(){o.$emit("task:done",p)})}}}var t=e("underscore");return n.$inject=["taskActivate","managerCanvas","$document","$window","$rootScope"],n}),define("taskManager/task/taskModule",["require","angular","underscore","./taskActivateProvider","./taskDirective"],function(e){var t=e("angular"),n=t.module("pi.task",[]),r=e("underscore");return n.provider("taskActivate",e("./taskActivateProvider")),n.directive("piTask",e("./taskDirective")),n.config(["taskActivateProvider",function(e){function t(e,t,n,r,i,s){var o;return s.name&&(i.name=s.name),n.script=i,t.append("<div pi-quest></div>"),o=t.contents(),r(o)(n),o.controller("piQuest").task.promise["finally"](function(){e()}),function(){o.scope().$destroy(),o.remove()}}t.$inject=["done","$element","$scope","$compile","script","task"],e.set("quest",t)}]),n.config(["taskActivateProvider",function(e){function t(e,t,n,r,i){var s;return r.script=n,t.append("<div pi-message></div>"),s=t.contents(),i(s)(r),r.$on("message:done",function(){e()}),function(){r.$destroy(),s.remove()}}t.$inject=["done","$element","task","$scope","$compile"],e.set("message",t)}]),n.config(["taskActivateProvider",function(e){function t(e,t,n,i){var s,o;return o=requirejs.config({context:r.uniqueId(),baseUrl:"../bower_components/PIPlayer/dist/js",paths:{text:["//cdnjs.cloudflare.com/ajax/libs/require-text/2.0.3/text.min","../../bower_components/requirejs-text/text"],jquery:["//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min","../../bower_components/jquery/dist/jquery.min"],underscore:["//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min","../../bower_components/lodash-compat/lodash.min"],backbone:["//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min","../../bower_components/backbone/backbone"]},deps:["jquery","backbone","underscore"]}),n.name&&(i.name=n.name),t.append("<div pi-player></div>"),s=t.contents(),s.addClass("pi-spinner"),o(["activatePIP"],function(t){s.removeClass("pi-spinner"),t(i,e)}),function(){s.remove(),o(["app/task/main_view"],function(e){e.deferred.resolve(),e.destroy()})}}t.$inject=["done","$element","task","script"],e.set("pip",t)}]),n}),define("taskManager/canvas/canvasConstructor",["require","underscore"],function(e){function n(e,n){var i;if(!t.isPlainObject(e))throw new Error("canvas(map): You must set a rule map for canvas to work properly");if(t.isUndefined(n))return t.noop;if(!t.isPlainObject(n))throw new Error("canvas(settings): canvas settings must be an object");return i=t.map(n,function(t,n){var i=e[n];if(i)return r(i.element,i.property,t);throw new Error("canvas("+n+"): unknow key in canvas object.")}),function(){t.forEach(i,function(e){e.call()})}}function r(e,n,r){var i=e.css(n);return e.css(n,r),t.bind(e.css,e,n,i)}var t=e("underscore");return n}),define("taskManager/canvas/managerCanvasService",["require","underscore","angular","./canvasConstructor"],function(e){function i(e,i){var s=n.element(i[0].body),o={background:{element:s,property:"backgroundColor"},canvasBackground:{element:e,property:"backgroundColor"},fontSize:{element:e,property:"fontSize"},fontColor:{element:e,property:"color"}};return t.bind(r,null,o)}var t=e("underscore"),n=e("angular"),r=e("./canvasConstructor");return i.$inject=["$rootElement","$document"],i}),define("taskManager/canvas/canvasModule",["require","angular","./managerCanvasService"],function(e){var t=e("angular"),n=t.module("pi.canvas",[]);return n.service("managerCanvas",e("./managerCanvasService")),n}),define("utils/helperDirectives/piSwap/piSwapDirective",["require","underscore"],function(e){function n(e){this.$scope=e}function r(e,r){return{transclude:!0,controller:n,controllerAs:"ctrl",compile:function(){return{pre:this.pre,post:function(){}}},pre:function(e,n,i,s,o){function c(e){var t=e||{};f&&(f.remove(),f=null),u&&(u.$destroy(),u=null),a&&(r.leave(a,function(){f=null,t.postLeave&&t.postLeave()}),f=a,a=null)}function h(n,i){var s=i||{};s.pre&&s.pre();if(!n)return c(s);var f=t.extend(e.$new(),n);o(f,function(e){d(e,s.animate),c(s),a=e,u=f,r.enter(a,l,null,function(){s.post&&s.post()})})}function p(e){t.extend(u,e)}function d(e,n){if(!n)return;var r=n.split(" ");t.each(r,function(e){$injector.has("."+e+"-animation")||piConsole(["page","animation"]).error('Unknown animation type: "'+e+'"')}),e.addClass(n)}e.enter=h,e.empty=c,e.refresh=p;var u,a,f,l=n}}}var t=e("underscore");return n.$inject=["$scope"],t.extend(n.prototype,{next:function(e,t){this.$scope.enter(e,t)},prev:function(e,t){this.$scope.enter(e,t)},refresh:function(e){this.$scope.refresh(e)},empty:function(e){this.$scope.empty(e)}}),r.$inject=["$compile","$animate"],r}),define("text!utils/helperDirectives/piSpinner/spinner.html",[],function(){return'<div>\n	<img ng-if="spinner" class="pi-logo" src="img/loader.gif" />\n	<div ng-if="!spinner" ng-transclude></div>\n</div>'}),define("utils/helperDirectives/piSpinner/piSpinnerDirective",["require","text!./spinner.html"],function(e){function n(){return{transclude:!0,replace:!0,template:t,require:[],scope:{spinner:"=piSpinner"}}}var t=e("text!./spinner.html");return n.$inject=[],n}),define("utils/helperDirectives/helperDirectivesModule",["require","angular","./piSwap/piSwapDirective","./piSpinner/piSpinnerDirective"],function(e){var t=e("angular"),n=t.module("piHelperDirective",[]);return n.directive("piSwap",e("./piSwap/piSwapDirective")),n.directive("piSpinner",e("./piSpinner/piSpinnerDirective")),n}),define("taskManager/managerService",["require","underscore"],function(e){function n(e,n,r,i,s,o){function u(e,t){var n=this,i,a=t.settings||{};if(!(this instanceof u))return new u(e,t);this.$scope=e,this.script=t,this.sequence=new r(t),i=s(a.canvas),e.$on("$destroy",i),a.title&&(o[0].title=t.settings.title),e.$on("manager:next",function(e,t){t||(t={type:"next"});switch(t.type){case"current":n.load(t);break;case"prev":n.prev(t);break;case"next":default:n.next(t)}}),e.$on("manager:prev",function(){n.prev()})}return t.extend(u.prototype,{next:function(e){this.sequence.next(),this.load(e)},prev:function(e){this.sequence.prev(),this.load(e)},current:function(){return this.sequence.current()},load:function(e){var t=this.current(),n=this.$scope,r={baseUrl:this.baseUrl,bustCache:e&&e.bustCache};t?i(t,r).then(function(){n.$emit("manager:loaded")}):n.$emit("manager:loaded")},setBaseUrl:function(e){this.baseUrl=e}}),u}var t=e("underscore");return n.$inject=["$rootScope","$q","managerSequence","managerTaskLoad","managerCanvas","$document"],n}),define("taskManager/managerSequence",["require","underscore"],function(e){function n(e){function n(t){var r;if(!(this instanceof n))return new n(t);r=this.db=new e,r.createColl("tasks"),r.add("tasks",t.tasksSets||[]),this.sequence=r.sequence("tasks",t.sequence)}return t.extend(n.prototype,{next:function(){return this.sequence.next(),this},prev:function(){return this.sequence.prev(),this},current:function(){return this.sequence.current()}}),n}var t=e("underscore");return n.$inject=["Database"],n}),define("taskManager/managerLoadService",["require","underscore"],function(e){function n(e,n){function r(r){var i=t.isString(r)?n(r):r;return e.when(i)}return r}var t=e("underscore");return n.$inject=["$q","managerGetScript"],n}),define("taskManager/managerGetScriptService",["require"],function(e){function t(t){function n(n,r){r||(r={});var i=t.defer(),s="";return/^\/|:/.test(n)||(s+=r.baseUrl?r.baseUrl+"/":""),s+=n,r.isText&&(s="text!"+s),r.bustCache&&(s+="?bust="+(new Date).getTime()),e([s],function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}return n}return t.$inject=["$q"],t}),define("taskManager/managerTaskLoadService",["require","underscore"],function(e){function n(e,n,r){function i(e,i){return n(e,i).then(function(n){var i;if(t.isUndefined(n))throw i=new Error("Task "+e+" failed or has not been found. Make sure that you returned the script and that your script does not have any errors"),r("task").error(i),i;return n})}function s(n,s){var o,u,a;n.scriptUrl?u=i(n.scriptUrl,s):u=n.script,n.templateUrl?a=i(n.templateUrl,t.extend({isText:!0},s)):a=n.template;if(!u&&!a)throw new Error('Tasks must have either a "script" property or a "scriptUrl" property (or a "template" property in specific cases).');return o=e.all({script:e.when(u),template:e.when(a)}),o.then(function(e){return n.$script=e.script,n.$template=e.template,n},function(e){r("load").error("Failed to load task script - make sure that your URLs are all correct.",e)}),o}return s}var t=e("underscore");return n.$inject=["$q","managerGetScript","piConsole"],n}),define("taskManager/managerDirective",["require","underscore"],function(e){function n(e,n,r,i){function s(s){function f(r){function i(e){if(!t.isString(e))return;return e.substring(0,e.lastIndexOf("/"))}e.script=r,e.settings=r&&r.settings||{},o.manager=new n(e,r),o.manager.setBaseUrl(i(u)),e.$emit("manager:next")}function l(e){i("manager").error("Failed to load "+u,e)}var o=this,u;try{u=e.$eval(s)}catch(a){}finally{u||(u=s)}r(u).then(f,l)}this.init=s}function r(e,r,i){return{priority:1e3,replace:!0,template:'<div pi-swap><div pi-task="task" ng-class="{\'pi-spinner\':loading}"></div></div>',controller:n,require:["piManager","piSwap"],link:function(n,s,o,u){function h(){n.loading=!1,c=l,l=f.manager.current(),i("manager").debug("Manager:currentTask",l),l?p():d()}function p(){var e={prevTask:c,currentTask:l};m([n.settings.onPreTask,c&&c.post,l.pre,t.bind(a.next,a,{task:l,settings:n.settings}),function(){n.loading=!1}],e)}function d(){var e={prevTask:c,currentTask:l};m([c&&c.post,t.bind(a.empty,a),n.settings.onEnd,function(){n.loading=!1,n.$emit("manager:done")}],e)}function v(e,t){e.stopPropagation(),n.loading=!0,n.$emit("manager:next",t)}function m(n,s){var o=e.when();t(n).map(function(n){return function(){var i=t.isFunction(n)?r.invoke(n,null,s||{}):n;return e.when(i)}}).reduce(function(e,t){return e.then(t,function(e){i("manager").error("There was an error in the task sequence. ",e)})},o)}var a=u[1],f=u[0],l,c;f.init(o.piManager),n.$on("manager:loaded",h),n.$on("task:done",v),n.loading=!0}}}var t=e("underscore");return n.$inject=["$scope","managerService","managerLoad","piConsole"],r.$inject=["$q","$injector","piConsole"],r}),define("taskManager/managerTaskDirective",[],function(){function e(){return{priority:1e3,template:'<div pi-manager="script"></div>',compile:function(){return{pre:function(e,t,n){var r,i=n.piManagerTask;try{r=e.$eval(i)}catch(s){}var o=r?r:{scriptUrl:i};e.script={sequence:[o]}}}}}}return e}),define("taskManager/managerModule",["require","angular","./task/taskModule","./canvas/canvasModule","utils/helperDirectives/helperDirectivesModule","utils/console/consoleModule","./managerService","./managerSequence","./managerLoadService","./managerGetScriptService","./managerTaskLoadService","./managerDirective","./managerTaskDirective"],function(e){var t=e("angular"),n=t.module("taskManager",[e("./task/taskModule").name,e("./canvas/canvasModule").name,e("utils/helperDirectives/helperDirectivesModule").name,e("utils/console/consoleModule").name]);return n.service("managerService",e("./managerService")),n.service("managerSequence",e("./managerSequence")),n.service("managerLoad",e("./managerLoadService")),n.service("managerGetScript",e("./managerGetScriptService")),n.service("managerTaskLoad",e("./managerTaskLoadService")),n.directive("piManager",e("./managerDirective")),n.directive("piManagerTask",e("./managerTaskDirective")),n}),define("utils/animations/rafPolyfill",[],function(){var e=["webkit","moz"];for(var t=0;t<e.length&&!window.requestAnimationFrame;++t){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var t=+(new Date),n=Math.max(r+16,t);return setTimeout(function(){e(r=n)},n-t)},window.cancelAnimationFrame=clearTimeout}}),define("utils/animations/dropInAnimation",[],function(){function e(e,t){var n=60,r=300,i=e.requestAnimationFrame,s=e.cancelAnimationFrame;return{enter:function(e,o){function l(){var e=t()-f,c=e/r;if(e>r){u.style.top=0,s(a),o();return}u.style.top=n*(c-1)+"px",a=i(l)}var u=e[0],a,f=t();return e.css({top:-n+"px"}),a=i(l),function(t){t&&(s(a),e.css({top:"0px"}))}},leave:function(e,o){function l(){var e=t()-f,c=1-e/r;if(e>r){s(a),o();return}u.style.top=n*(c-1)+"px",a=i(l)}var u=e[0],a,f=t();return a=i(l),function(e){e&&s(a)}}}}return["$window","timerNow",e]}),define("utils/animations/fadeAnimation",[],function(){function e(e,t){var n=300,r=e.requestAnimationFrame,i=e.cancelAnimationFrame;return{enter:function(e,s){function f(){var e=t()-a,l=e/n;if(e>n){o.style.opacity=1,i(u),s();return}o.style.opacity=l,u=r(f)}var o=e[0],u,a=t();return o.style.opacity=0,u=r(f),function(e){e&&(i(u),o.style.opacity=1)}},leave:function(e,s){function f(){var e=t()-a,l=1-e/n;if(e>n){o.style.opacity=0,i(u),s();return}o.style.opacity=l,u=r(f)}var o=e[0],u,a=t();return u=r(f),function(e){e&&(i(u),o.style.opacity=0)}}}}return["$window","timerNow",e]}),define("utils/animations/slideAnimation",[],function(){function e(e,t){var n=300,r=e.requestAnimationFrame,i=e.cancelAnimationFrame;return{enter:function(e,s){function f(){var e=t()-a,l=1-e/n;if(e>n){o.style.left="0%",i(u),s();return}o.style.left=-l*100+"%",u=r(f)}var o=e[0],u,a=t();return o.style.left="-100%",u=r(f),function(e){e&&(i(u),o.style.left="0%")}},leave:function(e,s){function f(){var e=t()-a,l=e/n;if(e>n){o.style.left="100%",i(u),s();return}o.style.left=l*100+"%",u=r(f)}var o=e[0],u,a=t();return u=r(f),function(e){e&&(i(u),o.style.left="100%")}}}}return["$window","timerNow",e]}),define("utils/animations/animationModule",["require","angular","animate","./rafPolyfill","./dropInAnimation","./fadeAnimation","./slideAnimation"],function(e){var t=e("angular");e("animate"),e("./rafPolyfill");var n=t.module("pi.animate",["ngAnimate"]);return n.animation(".drop-in",e("./dropInAnimation")),n.animation(".fade",e("./fadeAnimation")),n.animation(".slide",e("./slideAnimation")),n}),define("app",["require","angular","underscore","quest/questModule","message/messageModule","taskManager/managerModule","utils/animations/animationModule","utils/console/consoleModule"],function(e){var t=e("angular"),n=e("underscore"),r=[e("quest/questModule").name,e("message/messageModule").name,e("taskManager/managerModule").name,e("utils/animations/animationModule").name,e("utils/console/consoleModule").name],i=t.module("piApp",r);return i.run(["$rootScope","$rootElement","$parse","$window",function(e,t,r,i){var s=t.attr("pi-global"),o=r(s)(i);window.piGlobal||(window.piGlobal={}),e.global=window.piGlobal,o&&n.extend(e.global,o)}]),i}),define("pipScorer/computeD",["jquery"],function(e){function t(){e.extend(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}return e.extend(t.prototype,{setComputeObject:function(t){e.extend(this,t)},setDataArray:function(){var e=window.piGlobal;this.dataArray=e.current.logs}}),t}),define("pipScorer/msgMan",["underscore"],function(e){function t(){this.messages=e.extend({},n)}var n={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return e.extend(t.prototype,{setMsgObject:function(t){e.extend(this.messages,t)},getScoreMsg:function(t){var n=this.messages.MessageDef;if(!n||!n.length)throw new Error('You must define a "MessageDef" array.');var r=parseFloat(t),i=null,s=null,o="error: msg was not set",u=!1;if(e.each(n,function(e){i=parseFloat(e.cut),s=e.message,i>=r&&!u&&(o=s,u=!0)}),!u){var a=n.length,f=n[a-1];o=f.message}return o},getMessage:function(e){return this.messages[e]}}),t}),define("pipScorer/parcelMng",["underscore"],function(e){function t(e){this.parcelArray=[],this.scoreData={},this.msgMan=e}return e.extend(t.prototype,{Init:function(t){var n=this,r=this.msgMan,i=window.piGlobal,s=i.current.logs;n.parcelArray=[],n.scoreData={},n.msgMan=r;var o=t.AnalyzedVar,u=t.ErrorVar,a=t.parcelVar,f=t.parcelValue,l=t.minRT,c=t.maxRT,h=t.fastRT,p=0,d=0,v=0,m=0,g=parseFloat(t.maxFastTrialsRate);if("undefined"==typeof f||0===f.length){v=0,p=0,d=0,m=0;var y={};y.name="general",y.trialIData=[],e.each(s,function(e){e[o]>=l&&e[o]<=c?(v++,1==e.data[u]&&m++,n.validate(y,e,t)&&p++):e[o]<=h&&d++}),n.checkErrors(v,m,t),n.parcelArray[0]=y}else e.each(f,function(r,i){v=0,p=0,d=0,m=0;var f={};f.name=r,f.trialIData=[],e.each(s,function(e){var i=e.data[a];i==r&&(e[o]>=l&&e[o]<=c?(v++,1==e.data[u]&&m++,n.validate(f,e,t)&&p++):e[o]<=h&&d++)}),n.checkErrors(v,m,t),n.parcelArray[i]=f});d/p>g&&(n.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(e,t,n){var r=n.maxErrorParcelRate;t/e>r&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(e,t,n){var r=n.errorLatency,i=n.ErrorVar,s=t.data;return"latency"==r.use?(e.trialIData.push(t),!0):"false"==r.use?"1"==s[i]?!1:(e.trialIData.push(t),!0):"penalty"==r.use?(e.trialIData.push(t),!0):void 0},addPenalty:function(t,n){var r=n.errorLatency,i=this;if("penalty"==r.use){var s=parseFloat(r.penalty),o=n.ErrorVar,u=n.AnalyzedVar,a=n.condVar,f=n.cond1VarValues,l=n.cond2VarValues,c=t.trialIData,h=t.avgCon1,p=t.avgCon2;e.each(c,function(e){var t=e.data,n=t[o],r=t[a],c=i.checkArray(r,f),d=i.checkArray(r,l);"1"==n&&(c?e[u]+=h+s:d&&(e[u]+=p+s))})}},avgAll:function(t){var n=this;e.each(n.parcelArray,function(e){n.avgParcel(e,t)})},avgParcel:function(t,n){var r=this,i=t.trialIData,s=n.condVar,o=n.cond1VarValues,u=n.cond2VarValues,a=n.AnalyzedVar,f=0,l=0,c=0,h=0,p=0,d=0;e.each(i,function(e){var t=e[a],n=e.data;c+=t,d++;var i=n[s],v=r.checkArray(i,o),m=r.checkArray(i,u);v?(h++,f+=t):m&&(p++,l+=t)}),(2>=h||2>=p)&&(r.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==h&&(f/=h),0!==p&&(l/=p),t.avgCon1=f,t.avgCon2=l,t.diff=t.avgCon1-t.avgCon2,0!==d&&(t.avgBoth=c/d),r.addPenalty(t,n)},checkArray:function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r==e)return!0}return!1},varianceAll:function(t){var n=this;e.each(n.parcelArray,function(e){n.varianceParcel(e,t)})},varianceParcel:function(t,n){var r=this,i=n.AnalyzedVar,s=t.trialIData,o=n.cond1VarValues,u=n.cond2VarValues,a=n.condVar,f=t.avgBoth,l=0,c=0,h=[],p=[],d=[],v=n.errorLatency,m=v.useForSTD;e.each(s,function(e){var t=e.data,s=e[i],f=n.ErrorVar,l=t[f],c=t[a],d=r.checkArray(c,o),v=r.checkArray(c,u);d?m?h.push(s):"0"==l&&h.push(s):v&&(m?p.push(s):"0"==l&&h.push(s))}),d=h.concat(p),e.each(d,function(e){var t=e;l=t-f,c+=l*l}),t.variance=c/(d.length-1)},scoreAll:function(t){var n=this,r=0;e.each(n.parcelArray,function(e){n.scoreParcel(e,t),r+=e.score});var i=r/n.parcelArray.length;n.scoreData.score=i.toFixed(2)},scoreParcel:function(e){var t=this,n=Math.sqrt(e.variance);0===n?(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),e.score=e.diff):e.score=e.diff/n}}),t}),define("pipScorer/Scorer",["jquery","./computeD","./msgMan","./parcelMng"],function(e,t,n,r){function i(){this.computeData=new t,this.msgMan=new n,this.parcelMng=new r(this.msgMan)}return!!window.console||(console={log:e.noop,error:e.noop}),console.log||(console.log=function(){}),e.extend(i.prototype,{addSettings:function(e,t){switch(e){case"compute":this.computeData.setComputeObject(t);break;case"message":this.msgMan.setMsgObject(t);break;default:throw new Error('SCORER:addSettings: unknow "type" '+e)}},computeD:function(){var e=this.computeData,t=this.parcelMng;e.setDataArray(),t.Init(e),t.avgAll(e),t.varianceAll(e),t.scoreAll(e);var n=t.scoreData,r={};return void 0===n.errorMessage||null===n.errorMessage?(r.FBMsg=this.getFBMsg(n.score),r.DScore=n.score):(r.FBMsg=n.errorMessage,r.DScore=""),r},postToServer:function(t,n,r,i){var s=this.computeData.postSettings||{},o=s.url,u={};return r||(r=s.score),i||(i=s.msg),u[r]=t,u[i]=n,e.post(o,JSON.stringify(u))},dynamicPost:function(t){var n=this.computeData.postSettings||{},r=n.url;return e.post(r,JSON.stringify(t))},getFBMsg:function(e){var t=this.msgMan.getScoreMsg(e);return t}}),i}),define("pipScorer",["pipScorer/Scorer"],function(e){return e}),define("pipScorer",["pipScorer/Scorer"],function(e){return e}),define("APIs/APIConstructor",["require","underscore"],function(e){function r(r){function s(){var e=this.script={name:"anonymous "+r.type,settings:{},current:{},sequence:[]};this.settings=e.settings,t.forEach(r.sets,function(t){e[t+"Sets"]=[]})}return t.forEach(r.sets,function(e){s.prototype[t.camelCase("add-"+e+"-set")]=i(e)}),t.extend(s.prototype,{setName:function(e){this.script.name=e},addSettings:function(e,n){var r;return t.isPlainObject(n)?(r=this.settings[e]=this.settings[e]||{},t.extend(r,n)):this.settings[e]=n,this},addSequence:function(e){var n=this.script;return t.isArray(e)||(e=[e]),n.sequence=n.sequence.concat(e),this},addGlobal:function(e){if(!t.isPlainObject(e))throw new Error("global must be an object");return t.merge(n,e)},getGlobal:function(){return n},addCurrent:function(e){if(!t.isPlainObject(e))throw new Error("current must be an object");return t.merge(this.script.current,e)},getCurrent:function(){return this.script.current},addScript:function(e){return t.merge(this.script,e)},getScript:function(){return this.script},post:function(t,n){if(e.defined("jquery"))return e("jquery").ajax({type:"POST",url:t,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"});var r=angular.injector(["ng"]);return r.invoke(["$http",function(e){return e.post(t,n)}])},shuffle:function(e){return t.shuffle(e)}}),s}function i(e){function n(n,r){var i=this.script[e+"Sets"]||(this.script[e+"Sets"]=[]),s;t.isPlainObject(n)&&(s=t(n).map(function(e,n){return t.each(e,function(e){e.set=n}),e}).flatten().value()),t.isArray(n)&&(s=n),t.isString(n)&&(s=t.isArray(r)?r:[r],s=t.map(s,function(e){return e.set=n,e})),i.push.apply(i,s)}return n}window.piGlobal||(window.piGlobal={});var t=e("underscore"),n=window.piGlobal;return r}),define("pipAPI/pipAPI",["require","APIs/APIConstructor"],function(e){var t=e("APIs/APIConstructor"),n=t({type:"PIP",sets:["trial","stimulus","media"]});return n.prototype.addTrialSets=n.prototype.addTrialSet,n.prototype.addStimulusSets=n.prototype.addStimulusSet,n.prototype.addMediaSets=n.prototype.addMediaSet,n.prototype.getLogs=function(){return this.script.current.logs},n}),define("questAPI/questAPI",["require","APIs/APIConstructor"],function(e){var t=e("APIs/APIConstructor");return t({type:"quest",sets:["pages","questions"]})}),define("managerAPI/managerAPI",["require","APIs/APIConstructor"],function(e){var t=e("APIs/APIConstructor");return t({type:"manager",sets:["tasks"]})});