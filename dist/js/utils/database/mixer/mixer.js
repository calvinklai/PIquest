define(["underscore"],function(e){function t(t,n){function r(t){var n=t.mixer;if(!(e.isPlainObject(t)&&"mixer"in t))return[t];if(e.isUndefined(r.mixers[n]))throw new Error("Mixer: unknow mixer type = "+n);return!t.remix&&t.$parsed?t.$parsed:(t.$parsed=r.mixers[n].apply(null,arguments),t.$parsed)}return r.mixers={wrapper:function(e){return e.data},repeat:function(t){var n=t.data||[],r=[],i;for(i=0;i<t.times;i++)r=r.concat(e.clone(n,!0));return r},random:function(n,i){function s(t){return e.reduce(t,function(t,n){if(e.isPlainObject(n)&&"mixer"in n&&n.mixer!="wrapper"){var s=r(n,i);return t.concat(s)}return t.concat([n])},[])}var o=n.data||[];return t(s(o))},choose:function(n){var r=n.data||[];return e.take(t(r),n.n?n.n:1)},weightedRandom:function(t){var r=t.data||[],i,s=e.reduce(t.weights,function(e,t){return e+t}),o=n()*s,u=0;for(i=0;i<r.length;i++){u+=t.weights[i],u=+u.toFixed(3);if(o<=u)return[t.data[i]]}throw new Error("Mixer: something went wrong with weightedRandom")}},r}return t.$inject=["randomizeShuffle","randomizeRandom"],t});