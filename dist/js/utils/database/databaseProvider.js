define(["require","underscore"],function(e){function n(e,n,r,i,s){function o(){this.store=new e,this.randomizer=new n}return t.extend(o.prototype,{createColl:function(e){this.store.create(e)},getColl:function(e){return this.store.read(e)},add:function(e,t){var n=this.store.read(e);n.add(t)},inflate:function(e,t,n){var s=this.getColl(e);if(!t.$inflated||t.reinflate)t.$inflated=r(t,s,this.randomizer);if(!t.$templated||t.regenerateTemplate)n[e+"Data"]=t.$inflated.data||{},n[e+"Meta"]=t.$meta,t.$templated=i(t.$inflated,n);return t.$templated},sequence:function(e,n){if(!t.isArray(n))throw new Error("Sequence must be an array.");return new s(e,n,this)}}),o}var t=e("underscore");return n.$inject=["DatabaseStore","DatabaseRandomizer","databaseInflate","templateObj","databaseSequence"],n});