define(["underscore"],function(e){function t(){function t(n){if(n instanceof t)return n;if(!e.isUndefined(n)&&!e.isArray(n)&&!(n instanceof t))throw new Error("Collections can only be constructed from arrays");this.collection=n||[],this.length=this.collection.length,this.pointer=-1}e.extend(t.prototype,{first:function(){return this.pointer=0,this.collection[this.pointer]},last:function(){return this.pointer=this.collection.length-1,this.collection[this.pointer]},end:function(){return this.pointer=this.collection.length,undefined},current:function(){return this.collection[this.pointer]},next:function(){return this.collection[++this.pointer]},previous:function(){return this.collection[--this.pointer]},add:function(t){return arguments.length?(t=e.isArray(t)?t:[t],this.collection=this.collection.concat(t),this.length=this.collection.length,this):this},at:function(e){return this.collection[e]}});var n=["where","filter"],r=Array.prototype.slice;return e.each(n,function(n){t.prototype[n]=function(){var i=r.call(arguments);i.unshift(this.collection);var s=e[n].apply(e,i);return new t(s)}}),t}return t});