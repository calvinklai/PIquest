define(["underscore"],function(e){function t(t,n){function r(r,i,s){var o=new t(i);if(e.isFunction(r))return r(i);if(e.isString(r)||e.isNumber(r))r={set:r,type:"random"};r.set&&(o=o.where({set:r.set})),e.isPlainObject(r.data)&&(o=o.where({data:r.data})),e.isFunction(r.data)&&(o=o.filter(r.data));var u=r.seed||r.set,a=o.length,f=r.repeat,l,c;switch(r.type){case undefined:case"byData":case"random":l=s.random(a,u,f);break;case"exRandom":l=s.exRandom(a,u,f);break;case"sequential":l=s.sequential(a,u,f);break;case"first":l=0;break;case"last":l=a-1;break;default:throw new Error("Unknow query type: "+r.type)}if(e.isUndefined(o.at(l)))throw c=new Error("Query failed, object ("+JSON.stringify(r)+") not found. If you are trying to apply a template, you should know that they are not supported for inheritance."),n("query").error(c),c;return o.at(l)}return r}return t.$inject=["Collection","piConsole"],t});