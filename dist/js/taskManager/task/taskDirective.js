define([],function(){function e(e,t,n){return{scope:{task:"=piTask"},link:function(r,i){function h(e){var t=e.which||e.keyCode;t==116&&d(e,"current"),t==27&&n.one("keydown",p)}function p(e){var t=e.which||e.keyCode;t==37&&d(e,"prev"),t==39&&d(e,"next")}function d(e,t){e.preventDefault(),l={type:t},a.resolve()}var s=r.task,o,u,a,f,l,c=r.$parent.settings||{};if(!s)return;c.skip&&(n.on("keydown",h),r.$on("$destroy",function(){n.off("keydown",h),n.off("keydown",p)})),a=e(s,i,r.$new()),f=a.promise,o=t(s.canvas),f["finally"](o),s.title&&(u=n[0].title,n[0].title=s.title,f["finally"](function(){n[0].title=u})),f["finally"](function(){r.$emit("task:done",l)})}}}return e.$inject=["taskActivate","managerCanvas","$document"],e});