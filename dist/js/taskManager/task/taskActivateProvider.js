define(["require","underscore"],function(e){function n(){var e={};this.$get=r,this.set=function(n,r){e[n]=r},this.get=function(t){return e[t]}}function r(e,n,r){function s(s,o,u){var a,f=e.defer(),l=n.global,c=s.$script;t.isFunction(c)&&(a=c),!a&&c&&t.isFunction(c.play)&&(a=t.bind(c.play,c),a.$inject=r.annotate(c.play)),!a&&c&&t.isArray(c.play)&&(a=t.bind(c.play[c.play.length-1],c),a.$inject=r.annotate(c.play)),!a&&s.type&&(a=i.get(s.type));if(!t.isFunction(a))throw new Error('Activator function not found for the "'+s.type+'" task');return r.invoke(a,null,{done:t.bind(f.resolve,f),task:s,script:c,$element:o,$scope:u,global:l}),f.promise}var i=this;return s}var t=e("underscore");return r.$inject=["$q","$rootScope","$injector"],n});