define(["require","underscore"],function(e){function n(e,n,r){function i(e,i){return n(e,i).then(function(n){var i;if(t.isUndefined(n))throw i=new Error("Task "+e+" failed or has not been found. Make sure that you returned the script and that your script does not have any errors"),r("task").error(i),i;return n})}function s(n,s){var o,u,a;n.scriptUrl?u=i(n.scriptUrl,s):u=n.script,n.templateUrl?a=i(n.templateUrl,t.extend({isText:!0},s)):a=n.template;if(!u&&!a)throw new Error('Tasks must have either a "script" property or a "scriptUrl" property (or a "template" property in specific cases).');return o=e.all({script:e.when(u),template:e.when(a)}),o.then(function(e){return n.$script=e.script,n.$template=e.template,n},function(e){r("load").error("Failed to load task script - make sure that your URLs are all correct.",e)}),o}return s}var t=e("underscore");return n.$inject=["$q","managerGetScript","piConsole"],n});