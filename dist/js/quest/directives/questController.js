define(["require","underscore"],function(e){function n(e,n,r,i,s,o,u){function h(n,h){function v(e){var r=e.response,i=l.correctValue;return t.isNumber(i)&&(i+=""),t.isNumber(r)&&(r+=""),t.isEqual(i,r)?n.$setValidity("correct",!0):n.$setValidity("correct",!1),e}h=t.defaults(h||{},c),l=h.data;var p=r(i.ngModel),d=l.hasOwnProperty("dflt")?l.dflt:h.dflt;e.model=n,f=p(e.$parent),t.isUndefined(f)?(f={},p.assign(e.$parent,f)):s(["question"]).warn('This question has already been in use: "'+f.name+'"'),a.log=n.$modelValue=f,t.defaults(f,{name:l.name,response:d,serial:t.size(u.current&&u.current.questions)}),e.response=n.$viewValue=f.response,n.$formatters.push(function(e){return e.response}),n.$parsers.push(function(e){if(t.isUndefined(e))return f;var n=a.stopper.now();return f.response=e,f.latency=n,f.pristineLatency||(f.pristineLatency=n),f}),e.$watch("response",function(e,r){t.isEqual(e,r)||(n.$setViewValue(e),o(l.onChange,{log:f}))}),e.$on("$destroy",function(){o(l.onDestroy,{log:f})}),l.correct&&(n.$parsers.push(v),l.response=v(this.log)),o(l.onCreate,{log:f})}var a=this,f,l,c={dflt:NaN,data:e.data};this.scope=e,this.stopper=new n,this.registerModel=h,e.$on("quest:submit",function(e){e.preventDefault(),f.declined=undefined,f.submitLatency=a.stopper.now(),o(l.onSubmit,{log:f})}),e.$on("quest:decline",function(e){e.preventDefault(),f.declined=!0,f.submitLatency=a.stopper.now(),o(l.onDecline,{log:f})}),e.$on("quest:timeout",function(e){e.preventDefault(),f.timeout=!0,o(l.onTimeout,{log:f})})}var t=e("underscore");return n.$inject=["$scope","timerStopper","$parse","$attrs","piConsole","piInvoke","$rootScope"],n});