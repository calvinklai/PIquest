define(["underscore","text!./piQuest.html"],function(e,t){function n(t,n,r,i,s){function h(e,n){u.next(n),t.$emit("quest:newPage")}function p(e,n){u.prev(n),t.$emit("quest:newPage")}var o=this,u=o.task=new r(t.script),a,f=n.global,l=t.script,c=n.global[l.name||"current"]=n.current={questions:{}};l.current&&e.extend(c,l.current),l.global&&e.extend(f,l.global),a={global:f,current:c,questions:c.questions},e.extend(i,a),e.extend(s,a),u.next(),t.$on("quest:next",h),t.$on("quest:prev",p),t.$on("quest:log",function(e,n,r){u.log(n,r,t.global)})}function r(e,r){return{replace:!0,controller:n,link:function(n,i,s,o){function c(){l&&(l.remove(),l=null),a&&(a.$destroy(),a=null),f&&(r.leave(f,function(){l=null}),l=f,f=null)}function h(){var s=u.current();if(s){var o=n.$new();o.page=s,c(),f=e(t)(o),r.enabled(s.animate!==!1),r.enter(f,i),a=o,a.$emit("quest:updated")}else c()}function p(){a.page=u.current()}var u=o.task,a,f,l;n.$on("quest:refresh",p),n.$on("quest:newPage",h),h()}}}return n.$inject=["$scope","$rootScope","Task","templateDefaultContext","mixerDefaultContext"],r.$inject=["$compile","$animate"],r});