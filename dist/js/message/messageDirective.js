define(["require","underscore"],function(e){function n(e,n,r){return{link:function(i,s){function f(e){var n=t.isArray(u.keys)?u.keys:[u.keys],r=t.map(n,function(e){return t.isString(e)?e.toUpperCase().charCodeAt(0):e});~t.indexOf(r,e.which)&&i.done()}function l(){a.$destroy(),s.empty(),i.$emit("message:done")}var o="keydown",u=i.script,a=i.newScope=i.$new();i.global=n.global,i.current=n.current,i.done=l,r.on(o,f),i.$on("$destroy",function(){r.off(o,f)}),s.html(u.$template),e(s.contents())(a)}}}var t=e("underscore");return n.$inject=["$compile","$rootScope","$document"],n});