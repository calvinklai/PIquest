define(["angular","./messageModule"],function(e){describe("piMessage",function(){var t=e.element;beforeEach(module("pi.message")),describe("piMessage directive",function(){function i(){var i="<div pi-message></div>";n=t(i),r(n)(e)}var e,n,r;beforeEach(inject(function(t){e=t.get("$rootScope").$new(),r=t.get("$compile"),e.script={$template:""}})),it("should _.template script.$template",inject(function(t){t.current={content:123},e.script={$template:"test<%= current.content%>"},i(),expect(n.text()).toBe("test123")})),it("should catch _.template errors",function(){e.script={$template:"test<%= current.content%>"},expect(i).not.toThrow()}),it("should compile script.$template",function(){e.spy=jasmine.createSpy("onCompile"),e.script.$template='<div ng-init="spy()"></div>',i(),expect(e.spy).toHaveBeenCalled()}),it("should destroy everything when $scope.done",function(){var r=jasmine.createSpy("$destroy");i(),e.newScope.$on("$destroy",r),e.done(),expect(r).toHaveBeenCalled(),expect(t.trim(n.html())).not.toBeTruthy()}),describe(": keys",function(){function r(r,s){e.script.keys=r,i(),spyOn(e,"done");var o=t.Event("keydown",{which:s});n.trigger(o)}var n;beforeEach(inject(function(e){n=e})),it("should not break if keys is not set",function(){expect(function(){r(null,13)}).not.toThrow()}),it("should call done when key is pressed",function(){r(32,32),expect(e.done).toHaveBeenCalled()}),it("should take a simple string",function(){r("a",65),expect(e.done).toHaveBeenCalled()}),it("should take an array of values",function(){r(["a",32],32),expect(e.done).toHaveBeenCalled()}),it("should not trigger for a wrong keys",function(){r(["a",32],72),expect(e.done).not.toHaveBeenCalled()}),it("should remove listener when directive is destroyed",function(){r(32,0);var i=e.done;e.$destroy();var s=t.Event("keydown",{which:32});n.trigger(s),expect(i).not.toHaveBeenCalled()})}),describe("piMessageDone directive",function(){it("should call $scope.done on click",function(){e.script.$template="<div pi-message-done></div>",i(),spyOn(e,"done"),n.find("[pi-message-done]").trigger("click"),expect(e.done).toHaveBeenCalled()})})})})});