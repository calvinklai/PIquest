{"version":3,"file":"API.js","sources":["API.js"],"names":[],"mappings":"AAIA,OAAA,WAAA,UAAA,cAAA,SAAA,GAQA,QAAA,GAAA,GACA,KAAA,QACA,UACA,WACA,aACA,gBACA,aACA,aAGA,KAAA,OAAA,KAAA,GAAA,gBAEA,KAAA,SAAA,KAAA,OAAA,UACA,QACA,SAAA,IACA,YAAA,IAEA,UAoFA,QAAA,GAAA,GAiBA,QAAA,GAAA,EAAA,GAEA,GAEA,GAFA,EAAA,KAAA,OAAA,EAAA,UAAA,KAAA,OAAA,EAAA,WAIA,IAAA,EAAA,cAAA,GACA,EAAA,MAAA,EAAA,OAUA,KAJA,EAAA,QAAA,KAAA,GAAA,IACA,EAAA,KAAA,EAAA,OAGA,EAAA,EAAA,EAAA,EAAA,OAAA,IACA,EAAA,GAAA,KAAA,EAAA,aA9IA,GAAA,GAAA,EAAA,aAoGA,OAzEA,GAAA,OAAA,EAAA,WAGA,aAAA,EAAA,SACA,gBAAA,EAAA,YACA,aAAA,EAAA,SAGA,YAAA,SAAA,EAAA,GACA,GAAA,EASA,OAPA,GAAA,cAAA,IACA,EAAA,KAAA,SAAA,GAAA,KAAA,SAAA,OACA,EAAA,OAAA,EAAA,IAEA,KAAA,SAAA,GAAA,EAGA,MAGA,YAAA,SAAA,GACA,GAAA,GAAA,KAAA,MAKA,OAJA,GAAA,QAAA,KAAA,GAAA,IAEA,EAAA,SAAA,EAAA,SAAA,OAAA,GAEA,MAGA,UAAA,SAAA,GACA,IAAA,EAAA,cAAA,GACA,KAAA,IAAA,OAAA,2BAEA,GAAA,MAAA,KAAA,SAAA,IAGA,UAAA,WACA,MAAA,QAAA,UAGA,WAAA,SAAA,GACA,IAAA,EAAA,cAAA,GACA,KAAA,IAAA,OAAA,4BAEA,GAAA,MAAA,KAAA,OAAA,QAAA,IAGA,WAAA,WACA,MAAA,MAAA,OAAA,SAIA,UAAA,SAAA,GACA,EAAA,MAAA,KAAA,OAAA,IAIA,UAAA,WACA,MAAA,MAAA,QAGA,QAAA,WACA,MAAA,MAAA,OAAA,QAAA,MAIA,KAAA,WACA,KAAA,IAAA,OAAA,mEAKA","sourcesContent":["define('app/API',['require','underscore'],function(require){\r\n\r\n\tvar _ = require('underscore');\r\n\r\n\t/**\r\n\t * Constructor for PIPlayer script creator\r\n\t * @return {Object}\t\tScript creator\r\n\t */\r\n\tfunction API(name){\r\n\t\tthis.script = {\r\n\t\t\tglobal: {}, // the real global should be extended with this\r\n\t\t\tcurrent: {}, // this is the actual namespace for this PIP\r\n\t\t\ttrialSets: {},\r\n\t\t\tstimulusSets: {},\r\n\t\t\tmediaSets: {},\r\n\t\t\tsequence: []\r\n\t\t};\r\n\r\n\t\tthis.script.name = name || 'anonymous PIP';\r\n\r\n\t\tthis.settings = this.script.settings = {\r\n\t\t\tcanvas: {\r\n\t\t\t\tmaxWidth: 800,\r\n\t\t\t\tproportions: 0.8\r\n\t\t\t},\r\n\t\t\thooks: {}\r\n\t\t};\r\n\t}\r\n\r\n\t_.extend(API.prototype, {\r\n\r\n\t\t// add set function\r\n\t\taddTrialSets: add_set('trial'),\r\n\t\taddStimulusSets: add_set('stimulus'),\r\n\t\taddMediaSets: add_set('media'),\r\n\r\n\t\t// settings\r\n\t\taddSettings: function(name, settingsObj){\r\n\t\t\tvar settings;\r\n\r\n\t\t\tif (_.isPlainObject(settingsObj)){\r\n\t\t\t\tsettings = this.settings[name] = this.settings[name] || {};\r\n\t\t\t\t_.extend(settings, settingsObj);\r\n\t\t\t} else {\r\n\t\t\t\tthis.settings[name] = settingsObj;\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddSequence: function(sequence){\r\n\t\t\tvar script = this.script;\r\n\t\t\t_.isArray(sequence) || (sequence = [sequence]);\r\n\r\n\t\t\tscript.sequence = script.sequence.concat(sequence);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\taddGlobal: function(global){\r\n\t\t\tif (!_.isPlainObject(global)){\r\n\t\t\t\tthrow new Error('global must be an object');\r\n\t\t\t}\r\n\t\t\t_.merge(this.global(), global);\r\n\t\t},\r\n\r\n\t\tgetGlobal: function(){\r\n\t\t\treturn window.piGlobal;\r\n\t\t},\r\n\r\n\t\taddCurrent: function(current){\r\n\t\t\tif (!_.isPlainObject(current)){\r\n\t\t\t\tthrow new Error('current must be an object');\r\n\t\t\t}\r\n\t\t\t_.merge(this.script.current, current);\r\n\t\t},\r\n\r\n\t\tgetCurrent: function(){\r\n\t\t\treturn this.script.current;\r\n\t\t},\r\n\r\n\t\t// push a whole script\r\n\t\taddScript: function(obj){\r\n\t\t\t_.merge(this.script,obj);\r\n\t\t},\r\n\r\n\t\t// returns script (for debuging probably)\r\n\t\tgetScript: function(){\r\n\t\t\treturn this.script;\r\n\t\t},\r\n\r\n\t\tgetLogs: function(){\r\n\t\t\treturn this.script.current.logs;\r\n\t\t},\r\n\r\n\t\t// run the player, returns deferred\r\n\t\tplay: function(){\r\n\t\t\tthrow new Error('you should return API.script instead of calling API.play()!!');\r\n\t\t}\r\n\r\n\t});\r\n\r\n\treturn API;\r\n\r\n\t /**\r\n\t  * Create a function that adds sets of a scpecific type\r\n\t  * @param {String} type  \tThe type of set setter to create\r\n\t  * @returns {Function} \tA setter object\r\n\t  */\r\n\tfunction add_set(type){\r\n\r\n\t\t/**\r\n\t\t * Adds a set to the targetSet\r\n\t\t * @param {String, Object} set    \tEither full set object, or the name of this setArr\r\n\t\t * @param {Array} setArr \t\t\tAn array of objects for this set\r\n\t\t * @returns {Object} The API object\r\n\t\t *\r\n\t\t * use examples:\r\n\t\t * fn({\r\n\t\t *   intro: [intro1, intro2],\r\n\t\t *   Default: [defaultTrial]\r\n\t\t * })\r\n\t\t * fn('intro',[intro1, intro2])\r\n\t\t * fn('Default',defaultTrial)\r\n\t\t *\r\n\t\t */\r\n\t\tfunction setSetter(set, setArr){\r\n\t\t\t// get the sets we want to extend (or create them)\r\n\t\t\tvar targetSets = this.script[type + \"Sets\"] || (this.script[type + \"Sets\"] = {});\r\n\r\n\t\t\tvar i;\r\n\t\t\t// if we get an explicit object, simply extend the set\r\n\t\t\tif (_.isPlainObject(set)) {\r\n\t\t\t\t_.merge(targetSets, set);\r\n\t\t\t}\r\n\r\n\t\t\t// if we got a named object\r\n\t\t\telse {\r\n\t\t\t\t// make sure the objects to add are wrapped in an array\r\n\t\t\t\t_.isArray(setArr) || (setArr = [setArr]);\r\n\t\t\t\ttargetSets[set] || (targetSets[set] = []);\r\n\r\n\t\t\t\t// merge the objects into the targetSet\r\n\t\t\t\tfor (i=0;i<setArr.length; i++){\r\n\t\t\t\t\ttargetSets[set].push(setArr[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn setSetter;\r\n\t}\r\n});\n"]}