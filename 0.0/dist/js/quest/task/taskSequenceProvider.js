define(["require","underscore"],function(e){function n(e,n){function r(t,n,r){this.namespace=t,this.mixerSequence=new e(n),this.db=r}return t.extend(r.prototype,{next:function(e){return this.mixerSequence.next(e),this},prev:function(e){return this.mixerSequence.prev(e),this},current:function(e){e||(e={});var t=this.mixerSequence.current(e);if(!t)return t;if(!t.$inflated||t.reinflate)t.$inflated=this.db.inflate(this.namespace,t);if(!t.$templated||t.regenerateTemplate)e[this.namespace+"Data"]=t.$inflated.data||{},e[this.namespace+"Meta"]=t.$meta,t.$templated=n(t.$inflated,e);return t.$templated},all:function(e){var t=[],n=this.next().current(e);while(n)t.push(n),n=this.next().current(e);return t}}),r}var t=e("underscore");return n.$inject=["MixerSequence","templateObj"],n});