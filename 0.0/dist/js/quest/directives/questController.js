define(["require","underscore"],function(e){function n(e,n,r,i,s){var o=this,u,a=e.data,f={dflt:NaN};this.scope=e,this.stopper=new n,this.registerModel=function(n,l){l=t.defaults(l||{},f);var c=r(i.ngModel),h="dflt"in a?a.dflt:l.dflt;e.model=n,u=c(e.$parent),t.isUndefined(u)?(u={},c.assign(e.$parent,u)):s(["question"]).warn('This question has already been in use: "'+u.name+'"'),o.log=n.$modelValue=u,t.defaults(u,{name:a.name,response:h,serial:t.size(r("current.questions")(e.$parent))}),e.response=n.$viewValue=u.response,n.$formatters.push(function(e){return e.response}),n.$parsers.push(function(e){if(t.isUndefined(e))return u;var n=o.stopper.now();return u.response=e,u.latency=n,u.pristineLatency||(u.pristineLatency=n),u}),e.$watch("response",function(e,t){e!==t&&n.$setViewValue(e)});var p=function(e){var r=e.response,i=a.correctValue;return t.isNumber(i)&&(i+=""),t.isNumber(r)&&(r+=""),t.isEqual(i,r)?n.$setValidity("correct",!0):n.$setValidity("correct",!1),e};a.correct&&(n.$parsers.push(p),a.response=p(this.log))},e.$on("quest:submit",function(e){e.preventDefault(),u.declined=undefined,u.submitLatency=o.stopper.now()}),e.$on("quest:decline",function(e){e.preventDefault(),u.declined=!0,u.submitLatency=o.stopper.now()}),e.$on("quest:timeout",function(e){e.preventDefault(),u.timeout=!0})}var t=e("underscore");return n.$inject=["$scope","timerStopper","$parse","$attrs","piConsole"],n});