define(["require","underscore"],function(e){function n(e,n,r,i){return{link:function(s,o){function p(e){var n=t.isArray(a.keys)?a.keys:[a.keys],r=t.map(n,function(e){return t.isString(e)?e.toUpperCase().charCodeAt(0):e});~t.indexOf(r,e.which)&&s.done()}function d(){f.$destroy(),o.empty(),s.$emit("message:done")}var u="keydown",a=s.script,f=s.newScope=s.$new(),l,c={global:n.global,current:n.current,task:a};try{l=t.template(a.$template)(c)}catch(h){l=a.$template,i("message").error("failed to render template",h)}t.extend(s,c),s.done=d,r.on(u,p),s.$on("$destroy",function(){r.off(u,p)}),o.html(l),e(o.contents())(f)}}}var t=e("underscore");return n.$inject=["$compile","$rootScope","$document","piConsole"],n});