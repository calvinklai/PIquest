define(["require","underscore"],function(e){function n(e,n,r){function i(e){return t.isFunction(e.customize)&&e.customize.apply(e,[e,n.global]),e}function s(n,o,u,a,f){f=a?--f:10;if(!f)throw new Error("Inheritance loop too deep, you can only inherit up to 10 levels down");if(!t.isPlainObject(n))throw new Error("You are trying to inflate a non object");var l,c=t.cloneDeep(n),h,p=c.inherit;if(!c.inherit)return!a&&i(c),c;l=e(p,o,u);if(!l)throw h=new Error("Query failed, object ("+JSON.stringify(p)+") not found."),r("query").error(h),h;l=s(l,o,u,!0,f);if(p.merge&&!t.isArray(p.merge))throw new Error("Inheritance error: inherit.merge must be an array.");return t.each(l,function(e,n){var r,i;if(!(n in c)){c[n]=t.isFunction(e)?e:t.cloneDeep(e);return}if(t.indexOf(p.merge,n)!=-1){r=c[n],i=e;if(t.isArray(r)){if(!t.isArray(i))throw new Error('Inheritance error: You tried merging an array with an non array (for "'+n+'")');c[n]=r.concat(i)}if(t.isPlainObject(r)){if(!t.isPlainObject(i))throw new Error('Inheritance error: You tried merging an object with an non object (for "'+n+'")');t.extend(r,i)}}}),l.data&&(c.data=t.extend(l.data,c.data||{})),!a&&i(c),c}return s}var t=e("underscore");return n.$inject=["databaseQuery","$rootScope","piConsole"],n});