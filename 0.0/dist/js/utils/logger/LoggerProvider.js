define(["require","underscore"],function(e){function n(e,n,r){function s(e){this.pending=[],this.sent=[],this.settings={},this.meta={},this.suppress=!1,this.dfltLogFn=e||function(e){return e}}var i=this;return t.extend(s.prototype,{log:function(){var e=this.settings,n=(e.logFn||this.dfltLogFn).apply(e,arguments);if(!t.isEmpty(this.meta)&&!t.isPlainObject(n))throw r(["logger"]).debug(n),new Error('Logger: in order to use "meta" the log must be an object.');t.extend(n,this.meta),r(["logger"]).debug("Logged: ",n),this.pending.push(n),i.logCounter++,e.pulse&&!this.suppress&&this.pending.length>=e.pulse&&this.send()},send:function(){function a(){u.resolve()}function f(){return e.post(s.url,o).then(a,function(){r(["logger"]).error('Failed to send data, it seems the backend is not responding. (sending to: "'+s.url+'")'),u.reject()})}var i,s=this.settings,o=this.pending,u=n.defer();if(o.length===0)return u.resolve(),u.promise;if(t.isUndefined(s.url))return r("logger").warn("The logger url is not set."),u.resolve(),u.promise;this.pending=[],e.post(s.url,o).then(a,f);for(i=0;i<o.length;i++)this.sent.push(o[i]);return u.promise},suppressPulse:function(e){this.suppress=t.isUndefined(e)?!0:e},getCount:function(){return i.logCounter},setSettings:function(e){if(arguments.length===0)return this.settings;this.settings=t.defaults({},e,i.settings);if(!t.isUndefined(e.meta)&&!t.isPlainObject(e.meta))throw new Error('Logger: "meta" must be an object.');this.meta=t.defaults({},e.meta,i.meta)}}),s}var t=e("underscore");return n.$inject=["$http","$q","piConsole"],function(){this.$get=n,this.settings={},this.meta={},this.logCounter=0}});