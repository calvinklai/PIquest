define(["require","underscore"],function(e){function n(e){this.$q=e,this.loaders={},this.loaded=[]}function r(e,n){if(!t.isFunction(n))throw new Error("Fn is not a function");this.loaders[e]=n}function i(e,n){var r=this.loaders[e],i,s;s=this.getObj(e,n);if(!s){s={type:e,description:n},this.loaded.push(s);if(!t.isFunction(r))throw new Error('Loader "'+e+'" was not registered.');i=s.promise=r.call(this,n);if(!a(i))throw new Error('Loader "'+e+'" must return a promise.');return i.then(function(e){return s.promise=null,s.value=e,e}),i}return s.promise}function s(e,n){var r=this.$q,i;if(!t.isArray(n))throw new Error("descriptions must be an array.");return i=t.map(n,function(t){return this.load(e,t)},this),r.all(i)}function o(e,n){var r=t.find(this.loaded,function(t){return t.type===e&&t.description===n},this);return r}function u(e,t){var n=this.getObj(e,t);if("value"in n)return n.value;throw new Error('This object has not been loaded yet: "'+t+'"')}function a(e){return t.isPlainObject(e)&&t.isFunction(e.then)}var t=e("underscore");return n.$inject=["$q"],t.extend(n.prototype,{register:r,load:i,loadArr:s,get:u,getObj:o}),n});